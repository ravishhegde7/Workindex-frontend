<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"/>
<meta name="theme-color" content="#FC8019"/>
<title>WorkIndex</title>
<style>
/* ‚îÄ‚îÄ‚îÄ RESET ‚îÄ‚îÄ‚îÄ */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
html, body { height: 100%; overscroll-behavior: none; }
body {
  font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', system-ui, sans-serif;
  background: #fff; color: #3D4152;
  min-height: 100vh; min-height: 100dvh;
  overflow-x: hidden;
  -webkit-font-smoothing: antialiased;
}

:root {
  --primary: #FC8019;
  --primary-dark: #E67417;
  --bg: #FFFFFF;
  --bg-gray: #F9FAFB;
  --border: #E9E9EB;
  --text: #3D4152;
  --text-light: #686B78;
  --text-muted: #93959F;
  --green: #48C479;
  --red: #E74C3C;
  --yellow: #F5C518;
  --safe-top: env(safe-area-inset-top, 44px);
  --safe-bot: env(safe-area-inset-bottom, 34px);
}

.page { display: none; min-height: 100vh; animation: fadeIn .25s ease; }
.page.active { display: block; }
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

/* ‚ïê‚ïê‚ïê LANDING ‚ïê‚ïê‚ïê */
#landing { background: linear-gradient(135deg, #FFFAF6 0%, #FFF 100%); padding-top: var(--safe-top); }
.land-nav { display: flex; justify-content: space-between; align-items: center; padding: 16px 20px; }
.logo { display: flex; align-items: center; gap: 8px; }
.logo-icon { width: 36px; height: 36px; background: var(--primary); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 18px; color: #fff; }
.logo-text { font-size: 20px; font-weight: 800; color: var(--text); }

.land-btns { display: flex; gap: 8px; }
.btn-outline { padding: 8px 16px; border: 1.5px solid var(--border); border-radius: 8px; background: transparent; color: var(--text); font-size: 13px; font-weight: 600; cursor: pointer; }
.btn-primary { padding: 8px 16px; border: none; border-radius: 8px; background: var(--primary); color: #fff; font-size: 13px; font-weight: 700; cursor: pointer; }
.btn-primary:active, .btn-outline:active { opacity: 0.8; }

.hero { text-align: center; padding: 60px 24px 40px; }
.hero-badge { display: inline-flex; align-items: center; gap: 6px; background: #FFF4ED; border: 1px solid #FFDCC7; border-radius: 24px; padding: 6px 14px; margin-bottom: 20px; }
.hero-badge .dot { width: 6px; height: 6px; border-radius: 50%; background: var(--green); animation: pulse 2s infinite; }
@keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
.hero-badge span { font-size: 12px; color: var(--primary); font-weight: 600; }

.hero h1 { font-size: clamp(28px, 7vw, 46px); font-weight: 800; line-height: 1.15; letter-spacing: -0.5px; color: var(--text); margin-bottom: 14px; }
.hero .highlight { color: var(--primary); }
.hero p { font-size: 15px; color: var(--text-light); line-height: 1.6; max-width: 340px; margin: 0 auto 32px; }

.hero-actions { display: flex; flex-direction: column; gap: 12px; max-width: 360px; margin: 0 auto; }
.hero-btn { width: 100%; padding: 16px; border-radius: 12px; border: none; font-size: 16px; font-weight: 700; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; transition: transform .15s; }
.hero-btn:active { transform: scale(0.97); }
.hero-btn-orange { background: var(--primary); color: #fff; box-shadow: 0 4px 16px rgba(252,128,25,0.25); }
.hero-btn-white { background: #fff; border: 1.5px solid var(--border) !important; color: var(--text); }

.features { padding: 40px 20px 60px; }
.features h2 { text-align: center; font-size: 22px; font-weight: 700; color: var(--text); margin-bottom: 24px; }
.feat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
.feat-card { background: #fff; border: 1px solid var(--border); border-radius: 14px; padding: 20px 16px; text-align: center; }
.feat-card .icon { font-size: 32px; margin-bottom: 10px; }
.feat-card h4 { font-size: 14px; font-weight: 700; color: var(--text); margin-bottom: 4px; }
.feat-card p { font-size: 12px; color: var(--text-muted); line-height: 1.4; }

/* ‚ïê‚ïê‚ïê AUTH ‚ïê‚ïê‚ïê */
#auth { background: #fff; padding-top: var(--safe-top); min-height: 100vh; }
.auth-back { margin: 14px 20px 0; display: flex; align-items: center; gap: 5px; background: none; border: none; color: var(--text-light); font-size: 14px; font-weight: 600; cursor: pointer; }
.auth-wrap { padding: 32px 20px 60px; }
.auth-logo { text-align: center; margin-bottom: 32px; }
.auth-logo .logo-icon { width: 44px; height: 44px; font-size: 20px; margin: 0 auto 12px; }
.auth-card { background: #fff; border: 1px solid var(--border); border-radius: 16px; padding: 24px 20px; }

.auth-toggle { display: flex; background: var(--bg-gray); border-radius: 10px; padding: 4px; margin-bottom: 24px; }
.auth-toggle button { flex: 1; padding: 10px; border-radius: 8px; border: none; background: transparent; color: var(--text-muted); font-size: 14px; font-weight: 700; cursor: pointer; transition: all .2s; }
.auth-toggle button.active { background: #fff; color: var(--text); box-shadow: 0 2px 4px rgba(0,0,0,0.06); }

.role-pick { display: flex; gap: 12px; margin-bottom: 24px; }
.role-card { flex: 1; padding: 18px 12px; border: 2px solid var(--border); border-radius: 12px; background: #fff; text-align: center; cursor: pointer; transition: all .2s; }
.role-card.active { border-color: var(--primary); background: #FFF4ED; }
.role-card .r-icon { font-size: 28px; margin-bottom: 6px; }
.role-card .r-label { font-size: 14px; font-weight: 700; color: var(--text); }

.field { margin-bottom: 16px; }
.field label { font-size: 13px; font-weight: 600; color: var(--text); display: block; margin-bottom: 6px; }
.field input, .field select, .field textarea { width: 100%; padding: 12px 14px; background: var(--bg-gray); border: 1px solid var(--border); border-radius: 10px; color: var(--text); font-size: 15px; outline: none; font-family: inherit; }
.field input:focus, .field select:focus, .field textarea:focus { border-color: var(--primary); background: #fff; }
.field textarea { resize: none; }
.phone-row { display: flex; gap: 8px; }
.phone-prefix { padding: 12px 12px; background: var(--bg-gray); border: 1px solid var(--border); border-radius: 10px; color: var(--text-light); font-size: 15px; font-weight: 600; }

.submit-btn { width: 100%; padding: 14px; border-radius: 10px; border: none; background: var(--primary); color: #fff; font-size: 16px; font-weight: 700; cursor: pointer; margin-top: 8px; font-family: inherit; }
.submit-btn:active { opacity: 0.85; }
.submit-btn.disabled { background: #E9E9EB; color: var(--text-muted); cursor: not-allowed; }

.auth-footer { text-align: center; margin-top: 20px; font-size: 13px; color: var(--text-muted); }
.auth-footer a { color: var(--primary); cursor: pointer; font-weight: 600; text-decoration: none; }

.verify-steps { display: flex; justify-content: center; gap: 8px; margin-bottom: 24px; }
.v-step { flex: 1; max-width: 100px; height: 4px; border-radius: 2px; background: var(--border); transition: background .3s; }
.v-step.done { background: var(--primary); }
.verify-title { text-align: center; font-size: 22px; font-weight: 700; margin-bottom: 8px; color: var(--text); }
.verify-sub { text-align: center; font-size: 14px; color: var(--text-light); margin-bottom: 24px; }
.otp-input { width: 100%; padding: 16px; text-align: center; letter-spacing: 8px; font-size: 22px; font-weight: 700; background: var(--bg-gray); border: 1px solid var(--border); border-radius: 12px; color: var(--text); outline: none; font-family: 'Courier New', monospace; }
.otp-input:focus { border-color: var(--primary); background: #fff; }
.resend { text-align: center; color: var(--primary); font-size: 14px; font-weight: 600; cursor: pointer; margin: 14px 0 20px; }

/* ‚ïê‚ïê‚ïê QUESTIONNAIRE ‚ïê‚ïê‚ïê */
#questionnaire { background: #fff; padding-top: var(--safe-top); min-height: 100vh; padding-bottom: 80px; }
.q-progress { background: var(--bg-gray); padding: 16px 20px; border-bottom: 1px solid var(--border); }
.q-progress-bar { height: 6px; background: var(--border); border-radius: 3px; overflow: hidden; }
.q-progress-fill { height: 100%; background: var(--primary); border-radius: 3px; transition: width .3s; }
.q-step-text { font-size: 12px; color: var(--text-muted); margin-top: 6px; }

.q-content { padding: 28px 20px; }
.q-title { font-size: 20px; font-weight: 700; color: var(--text); margin-bottom: 8px; }
.q-subtitle { font-size: 14px; color: var(--text-light); margin-bottom: 24px; }

.q-options { display: flex; flex-direction: column; gap: 10px; }
.q-option { padding: 16px; border: 2px solid var(--border); border-radius: 12px; background: #fff; text-align: left; cursor: pointer; transition: all .2s; display: flex; align-items: center; gap: 12px; }
.q-option:active { transform: scale(0.98); }
.q-option.selected { border-color: var(--primary); background: #FFF4ED; }
.q-option .opt-icon { font-size: 24px; flex-shrink: 0; }
.q-option .opt-text { flex: 1; }
.q-option .opt-label { font-size: 15px; font-weight: 700; color: var(--text); }
.q-option .opt-desc { font-size: 12px; color: var(--text-muted); margin-top: 2px; }

.q-nav { position: fixed; bottom: 0; left: 0; right: 0; background: #fff; border-top: 1px solid var(--border); padding: 12px 20px; padding-bottom: calc(12px + var(--safe-bot)); display: flex; gap: 10px; }
.q-btn-back { flex: 0 0 auto; padding: 12px 20px; border: 1px solid var(--border); border-radius: 10px; background: #fff; color: var(--text); font-size: 15px; font-weight: 600; cursor: pointer; font-family: inherit; }
.q-btn-next { flex: 1; padding: 12px; border: none; border-radius: 10px; background: var(--primary); color: #fff; font-size: 15px; font-weight: 700; cursor: pointer; font-family: inherit; }
.q-btn-next:active { opacity: 0.85; }
.q-btn-next.disabled { background: #E9E9EB; color: var(--text-muted); cursor: not-allowed; }

.chip-grid { display: flex; flex-wrap: wrap; gap: 8px; }
.chip { padding: 10px 16px; border: 1.5px solid var(--border); border-radius: 20px; background: #fff; color: var(--text); font-size: 14px; font-weight: 600; cursor: pointer; transition: all .2s; }
.chip.selected { border-color: var(--primary); background: #FFF4ED; color: var(--primary); }

/* ‚ïê‚ïê‚ïê DASHBOARDS ‚ïê‚ïê‚ïê */
#clientDash, #expertDash { background: var(--bg-gray); padding-top: var(--safe-top); min-height: 100vh; padding-bottom: calc(70px + var(--safe-bot)); }
.dash-header { background: #fff; border-bottom: 1px solid var(--border); padding: 14px 20px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 40; }
.avatar { width: 36px; height: 36px; border-radius: 50%; background: var(--primary); display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: 700; color: #fff; cursor: pointer; }

.tab-content { padding: 18px 20px; }

.req-card { background: #fff; border: 1px solid var(--border); border-radius: 14px; padding: 18px; margin-bottom: 12px; }
.req-top { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px; }
.req-left h4 { font-size: 16px; font-weight: 700; color: var(--text); margin-bottom: 4px; }
.req-left .meta { font-size: 12px; color: var(--text-muted); }
.status-badge { padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.3px; }
.status-badge.pending { background: #FFF4ED; color: var(--primary); }
.status-badge.active { background: #E8F5E9; color: var(--green); }
.req-desc { font-size: 14px; color: var(--text-light); line-height: 1.5; margin-bottom: 12px; }
.req-footer { display: flex; justify-content: space-between; align-items: center; padding-top: 10px; border-top: 1px solid var(--border); }

.response-card { background: #F9FAFB; border: 1px solid var(--border); border-radius: 12px; padding: 14px; margin-top: 10px; }
.resp-header { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
.resp-avatar { width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #FC8019, #E67417); display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: 700; color: #fff; }
.resp-info h5 { font-size: 14px; font-weight: 700; color: var(--text); }
.resp-info .rating { font-size: 12px; color: var(--text-muted); margin-top: 2px; }
.resp-body { font-size: 13px; color: var(--text-light); line-height: 1.5; margin-bottom: 10px; }

.empty-state { text-align: center; padding: 60px 20px; }
.empty-state .icon { font-size: 64px; margin-bottom: 16px; opacity: 0.3; }
.empty-state h3 { font-size: 18px; font-weight: 700; color: var(--text); margin-bottom: 8px; }
.empty-state p { font-size: 14px; color: var(--text-muted); }

/* ‚ïê‚ïê‚ïê EXPERT ‚ïê‚ïê‚ïê */
.credit-badge { display: flex; align-items: center; gap: 5px; padding: 6px 12px; border-radius: 18px; background: #FFF4ED; border: 1px solid var(--primary); color: var(--primary); font-size: 13px; font-weight: 700; cursor: pointer; }

.filter-bar { background: #fff; border-bottom: 1px solid var(--border); padding: 12px 20px; }
.filter-pills { display: flex; gap: 8px; overflow-x: auto; -webkit-overflow-scrolling: touch; scrollbar-width: none; }
.filter-pills::-webkit-scrollbar { display: none; }
.filter-pill { padding: 8px 16px; border: 1px solid var(--border); border-radius: 20px; background: #fff; color: var(--text-muted); font-size: 13px; font-weight: 600; white-space: nowrap; cursor: pointer; }
.filter-pill.active { border-color: var(--primary); background: #FFF4ED; color: var(--primary); }

.req-list { padding: 14px 20px; }
.browse-card { background: #fff; border: 1px solid var(--border); border-radius: 14px; padding: 16px; margin-bottom: 12px; cursor: pointer; position: relative; }
.browse-card:active { transform: scale(0.99); }
.browse-credit { position: absolute; top: 16px; right: 16px; padding: 4px 10px; border-radius: 12px; background: #FFF4ED; color: var(--primary); font-size: 11px; font-weight: 700; }
.browse-top { display: flex; align-items: flex-start; margin-bottom: 8px; padding-right: 70px; }
.browse-cat { display: flex; align-items: center; gap: 8px; }
.cat-icon { font-size: 20px; }
.browse-cat h4 { font-size: 15px; font-weight: 700; color: var(--text); }
.browse-desc { font-size: 13px; color: var(--text-light); line-height: 1.5; margin-bottom: 10px; }
.browse-footer { display: flex; justify-content: space-between; align-items: center; }

.approach-card { background: #fff; border: 1px solid var(--border); border-radius: 14px; padding: 16px; margin-bottom: 12px; }
.approach-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
.approach-header h4 { font-size: 15px; font-weight: 700; color: var(--text); }
.approach-status { padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 700; text-transform: uppercase; }
.approach-status.sent { background: #FFF4ED; color: var(--primary); }
.approach-status.unlocked { background: #E8F5E9; color: var(--green); }

.contact-info { background: #E8F5E9; border: 1px solid #C8E6C9; border-radius: 10px; padding: 12px; margin-top: 10px; }
.contact-info h5 { font-size: 13px; font-weight: 700; color: var(--text); margin-bottom: 6px; }
.contact-info p { font-size: 13px; color: var(--text-light); margin-bottom: 3px; }

/* profile */
.profile-section { background: #fff; border: 1px solid var(--border); border-radius: 14px; padding: 20px; margin-bottom: 16px; }
.profile-header { text-align: center; margin-bottom: 20px; }
.profile-avatar-lg { width: 80px; height: 80px; border-radius: 50%; background: linear-gradient(135deg, #FC8019, #E67417); display: flex; align-items: center; justify-content: center; font-size: 28px; font-weight: 800; color: #fff; margin: 0 auto 12px; }
.profile-name { font-size: 20px; font-weight: 700; color: var(--text); margin-bottom: 4px; }
.profile-specialty { font-size: 14px; color: var(--text-muted); margin-bottom: 8px; }

.section-title { font-size: 16px; font-weight: 700; color: var(--text); margin-bottom: 12px; }
.qual-item { padding: 12px; background: var(--bg-gray); border-radius: 10px; margin-bottom: 8px; }
.qual-item h5 { font-size: 14px; font-weight: 700; color: var(--text); margin-bottom: 2px; }
.qual-item p { font-size: 12px; color: var(--text-muted); }

/* ‚ïê‚ïê‚ïê BOTTOM NAV ‚ïê‚ïê‚ïê */
.bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: #fff; border-top: 1px solid var(--border); display: flex; padding-bottom: var(--safe-bot); z-index: 50; }
.nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 4px; padding: 10px 0; background: none; border: none; color: var(--text-muted); cursor: pointer; font-size: 11px; font-weight: 600; font-family: inherit; }
.nav-item svg { width: 22px; height: 22px; }
.nav-item.active { color: var(--primary); }

/* ‚ïê‚ïê‚ïê MODAL ‚ïê‚ïê‚ïê */
.modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); backdrop-filter: blur(2px); z-index: 100; display: none; align-items: flex-end; }
.modal-overlay.open { display: flex; animation: fadeIn .2s ease; }
.modal-sheet { background: #fff; border-radius: 20px 20px 0 0; width: 100%; max-height: 85vh; overflow-y: auto; padding: 0 20px calc(24px + var(--safe-bot)); animation: slideUp .25s ease; }
@keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
.modal-handle { width: 36px; height: 4px; background: var(--border); border-radius: 2px; margin: 12px auto 20px; }
.modal-title { font-size: 20px; font-weight: 700; color: var(--text); margin-bottom: 8px; }
.modal-subtitle { font-size: 14px; color: var(--text-muted); margin-bottom: 20px; }

.credit-pack { background: #fff; border: 2px solid var(--border); border-radius: 14px; padding: 20px 16px; margin-bottom: 12px; cursor: pointer; text-align: center; position: relative; }
.credit-pack.popular { border-color: var(--primary); background: #FFF4ED; }
.credit-pack .badge { position: absolute; top: -10px; left: 50%; transform: translateX(-50%); background: var(--primary); color: #fff; padding: 3px 12px; border-radius: 12px; font-size: 10px; font-weight: 700; text-transform: uppercase; }
.credit-pack .amount { font-size: 28px; font-weight: 800; color: var(--text); margin-bottom: 4px; }
.credit-pack .credits { font-size: 13px; color: var(--text-muted); margin-bottom: 10px; }
.credit-pack .price { font-size: 22px; font-weight: 700; color: var(--primary); }
.credit-pack .per-credit { font-size: 12px; color: var(--text-muted); margin-top: 2px; }
.credit-pack .savings { font-size: 11px; color: var(--green); font-weight: 600; margin-top: 4px; }

.unlock-preview { background: var(--bg-gray); border-radius: 12px; padding: 14px; margin-bottom: 16px; }
.unlock-preview h4 { font-size: 15px; font-weight: 700; color: var(--text); margin-bottom: 6px; }
.unlock-preview .detail { font-size: 13px; color: var(--text-light); margin-bottom: 3px; }
</style>
</head>
<body>

<!-- LANDING -->
<div id="landing" class="page active">
  <nav class="land-nav">
    <div class="logo">
      <div class="logo-icon">W</div>
      <div class="logo-text">WorkIndex</div>
    </div>
    <div class="land-btns">
      <button class="btn-outline" onclick="goAuth('login')">Log In</button>
      <button class="btn-primary" onclick="goAuth('signup')">Sign Up</button>
    </div>
  </nav>

  <div class="hero">
    <h1>Find the <span class="highlight">right expert</span> for your needs</h1>
    <p>From ITR filing to app development ‚Äî connect with verified professionals instantly.</p>
    <div class="hero-actions">
      <button class="hero-btn hero-btn-orange" onclick="goAuth('signup', 'client')">
        üìã I need help (Client)
      </button>
      <button class="hero-btn hero-btn-white" onclick="goAuth('signup', 'expert')">
        üíº I'm a professional (Expert)
      </button>
    </div>
  </div>

  <div class="features">
    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-bottom:32px;text-align:center;">
      <div>
        <div style="font-size:28px;font-weight:800;color:var(--primary);">500+</div>
        <div style="font-size:12px;color:var(--text-muted);">Active Experts</div>
      </div>
      <div>
        <div style="font-size:28px;font-weight:800;color:var(--primary);">1.2K+</div>
        <div style="font-size:12px;color:var(--text-muted);">Projects Done</div>
      </div>
      <div>
        <div style="font-size:28px;font-weight:800;color:var(--primary);">98%</div>
        <div style="font-size:12px;color:var(--text-muted);">Satisfaction</div>
      </div>
    </div>
    
    <h2>How it works</h2>
    <div class="feat-grid">
      <div class="feat-card"><div class="icon">üìù</div><h4>Post Your Need</h4><p>Answer questions</p></div>
      <div class="feat-card"><div class="icon">üëÄ</div><h4>Get Approaches</h4><p>Experts reach out</p></div>
      <div class="feat-card"><div class="icon">‚úÖ</div><h4>Choose Expert</h4><p>Review & select</p></div>
      <div class="feat-card"><div class="icon">ü§ù</div><h4>Get Work Done</h4><p>Connect & complete</p></div>
    </div>
  </div>
</div>

<!-- AUTH -->
<div id="auth" class="page">
  <button class="auth-back" onclick="goPage('landing')">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5"><path d="M19 12H5M12 19l-7-7 7-7"/></svg> Back
  </button>
  
  <div class="auth-wrap">
    <div class="auth-logo">
      <div class="logo-icon">W</div>
      <div class="logo-text">WorkIndex</div>
    </div>

    <div id="authForm" class="auth-card">
      <div class="auth-toggle">
        <button id="toggleLogin" class="active" onclick="switchAuth('login')">Log In</button>
        <button id="toggleSignup" onclick="switchAuth('signup')">Sign Up</button>
      </div>

      <label style="font-size:13px; font-weight:600; color:var(--text); margin-bottom:8px; display:block;">I am a</label>
      <div class="role-pick">
        <div class="role-card" id="roleClient" onclick="pickRole('client')">
          <div class="r-icon">üìã</div>
          <div class="r-label">Client</div>
        </div>
        <div class="role-card" id="roleExpert" onclick="pickRole('expert')">
          <div class="r-icon">üíº</div>
          <div class="r-label">Expert</div>
        </div>
      </div>

      <div id="nameField" class="field" style="display:none;">
        <label>Full Name</label>
        <input type="text" id="inName" placeholder="Enter your full name">
      </div>

      <div class="field">
        <label>Email Address</label>
        <input type="email" id="inEmail" placeholder="you@example.com">
      </div>

      <div class="field">
        <label>Phone Number</label>
        <div class="phone-row">
          <div class="phone-prefix">+91</div>
          <input type="tel" id="inPhone" placeholder="9876543210" maxlength="10">
        </div>
      </div>

      <div class="field">
        <label>Password</label>
        <input type="password" id="inPass" placeholder="Create a password">
      </div>

      <button class="submit-btn disabled" id="authSubmit" onclick="submitAuth()">Continue</button>

      <div class="auth-footer" id="authFooter">
        Already have an account? <a onclick="switchAuth('signup')">Sign up</a>
      </div>
    </div>

    <div id="verifyForm" class="auth-card" style="display:none;">
      <div class="verify-steps">
        <div class="v-step done" id="vStep0"></div>
        <div class="v-step" id="vStep1"></div>
      </div>
      <div class="verify-title" id="verifyTitle">Verify Email</div>
      <div class="verify-sub" id="verifySub">Enter the 6-digit code sent to your email</div>
      <input class="otp-input" id="otpInput" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" maxlength="6" inputmode="numeric">
      <div class="resend">Resend code</div>
      <button class="submit-btn" id="verifyBtn" onclick="submitVerify()">Verify & Continue</button>
    </div>
  </div>
</div>

<!-- QUESTIONNAIRE -->
<div id="questionnaire" class="page">
  <div class="q-progress">
    <div style="display:flex;justify-content:space-between;align-items:center;padding:0 20px 10px;">
      <div class="q-step-text" id="qStepText">Step 1 of 10</div>
      <button onclick="if(confirm('Exit questionnaire? Progress will be lost.')){enterDashboard()}" style="padding:6px 12px;border:1px solid var(--border);border-radius:6px;background:#fff;color:var(--text);font-size:12px;font-weight:600;cursor:pointer;">Exit</button>
    </div>
    <div class="q-progress-bar">
      <div class="q-progress-fill" id="qProgressFill" style="width:0%"></div>
    </div>
  </div>

  <div class="q-content" id="qContent"></div>

<div class="q-nav"> ${state.qStep > 0 ? '<button class="q-btn-back" onclick="handleBack()">‚Üê Back</button>' : ''}${q.skip ? '<button class="q-btn-back" id="qSkipBtn" onclick="skipQuestion()">Skip</button>' : ''} <button class="q-btn-next" onclick="handleNext()">${state.qStep === QUESTIONNAIRE_DATA[state.role].length - 1 ? 'Finish' : 'Next'}‚Üí</button> </div> `;

<!-- CLIENT DASHBOARD -->
<div id="clientDash" class="page">
  <div class="dash-header">
    <div class="logo">
      <div class="logo-icon">W</div>
      <div class="logo-text">WorkIndex</div>
    </div>
    <div style="display:flex;align-items:center;gap:10px;">
      <button onclick="logout()" style="padding:6px 12px;border:1px solid var(--border);border-radius:6px;background:#fff;color:var(--text);font-size:12px;font-weight:600;cursor:pointer;">Logout</button>
      <div class="avatar" id="clientAvatar" onclick="clientSwitchTab('profile')">AK</div>
    </div>
  </div>

  <div id="clientTabRequests" class="tab-content"></div>

  <div id="clientTabProfile" class="tab-content" style="display:none;">
    <div class="profile-section">
      <div class="profile-header">
        <div class="profile-avatar-lg" id="clientProfAvatar">AK</div>
        <div class="profile-name" id="clientProfName">Client Name</div>
        <div class="profile-specialty" id="clientProfEmail"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="61040c00080d210419000c110d044f020e0c">[email&#160;protected]</a></div>
      </div>
      <div class="section-title">Account Details</div>
      <div class="qual-item">
        <h5>Phone</h5>
        <p id="clientProfPhone">+91 9876543210</p>
      </div>
      <div class="qual-item">
        <h5>Member Since</h5>
        <p>February 2026</p>
      </div>
      <button class="submit-btn" style="margin-top:20px;" onclick="logout()">Log Out</button>
    </div>
  </div>

  <div class="bottom-nav">
    <button class="nav-item active" id="clientNavReq" onclick="clientSwitchTab('requests')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M9 11h6M9 15h6"/></svg>
      My Requests
    </button>
    <button class="nav-item" id="clientNavPost" onclick="startQuestionnaire()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><path d="M12 8v8M8 12h8"/></svg>
      Post New
    </button>
    <button class="nav-item" id="clientNavProf" onclick="clientSwitchTab('profile')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="8" r="4"/></svg>
      Profile
    </button>
  </div>
</div>

<!-- EXPERT DASHBOARD -->
<div id="expertDash" class="page">
  <div class="dash-header">
    <div class="logo">
      <div class="logo-icon">W</div>
      <div class="logo-text">WorkIndex</div>
    </div>
    <div style="display:flex; align-items:center; gap:10px;">
      <button onclick="logout()" style="padding:6px 12px;border:1px solid var(--border);border-radius:6px;background:#fff;color:var(--text);font-size:12px;font-weight:600;cursor:pointer;">Logout</button>
      <div class="credit-badge" id="expertCreditBadge" onclick="openBuyCredits()">üíé <span id="expertCredits">50</span></div>
      <div class="avatar" id="expertAvatar" onclick="expertSwitchTab('profile')">PS</div>
    </div>
  </div>

  <div id="expertTabBrowse" style="display:none;">
    <div class="filter-bar">
      <div class="filter-pills" id="expertFilterPills"></div>
    </div>
    <div class="req-list" id="expertBrowseList"></div>
  </div>

  <div id="expertTabApproaches" class="tab-content" style="display:none;"></div>

  <div id="expertTabProfile" class="tab-content" style="display:none;">
    <div class="profile-section">
      <div class="profile-header">
        <div class="profile-avatar-lg" id="expertProfAvatar">PS</div>
        <button onclick="openEditProfile()" style="margin-top:12px;padding:8px 16px;border:1px solid var(--primary);border-radius:8px;background:#fff;color:var(--primary);font-size:13px;font-weight:600;cursor:pointer;">Edit Profile</button>
        <div class="profile-name" id="expertProfName" style="margin-top:12px;">Expert Name</div>
        <div class="profile-specialty" id="expertProfSpec" style="color:var(--text-muted);font-size:14px;">Specialization</div>
      </div>

      <div id="expertProfileContent"></div>

      <button class="submit-btn" style="margin-top:20px;" onclick="logout()">Log Out</button>
    </div>
  </div>

  <div class="bottom-nav">
    <button class="nav-item active" id="expertNavBrowse" onclick="expertSwitchTab('browse')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
      Browse
    </button>
    <button class="nav-item" id="expertNavApp" onclick="expertSwitchTab('approaches')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
      Approaches
    </button>
    <button class="nav-item" id="expertNavProf" onclick="expertSwitchTab('profile')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="8" r="4"/></svg>
      Profile
    </button>
  </div>
</div>

<!-- MODAL -->
<div class="modal-overlay" id="modal" onclick="closeModal()">
  <div class="modal-sheet" onclick="event.stopPropagation()">
    <div class="modal-handle"></div>
    <div id="modalContent"></div>
  </div>
</div>

<script>
// ‚ïê‚ïê‚ïê API CONFIGURATION ‚ïê‚ïê‚ïê
const API_URL = 'https://workindex-production.up.railway.app/api';

// STATE
let state = {
  role: null,
  user: null,
  userId: null,
  token: null,
  authMode: 'login',
  verifyStep: 0,
  qStep: 0,
  qAnswers: {},
  qSequence: null,
  clientRequests: [],
  expertApproaches: [],
  expertCredits: 50,
  unlockedRequests: []
};

// CREDIT PRICING (‚Çπ30 per credit)
const CREDIT_PACKS = [
  { credits: 20, price: 600, savings: 0 },
  { credits: 50, price: 1500, savings: 0 },
  { credits: 100, price: 2700, savings: 10, popular: true },
  { credits: 200, price: 4800, savings: 20 }
];

// CREDIT REQUIREMENTS
function calculateCredits(service, answers) {
  const base = { itr: 15, gst: 20, accounting: 25, audit: 30, photography: 18, development: 35 };
  let credits = base[service] || 20;
  
  if (service === 'itr') {
    if (answers.incomeBracket === '25+') credits = 25;
    if (answers.incomeSource && answers.incomeSource.includes('business')) credits = 30;
  }
  
  if (service === 'gst' && answers.turnover === '20cr+') credits = 30;
  if (service === 'accounting' && answers.employees && parseInt(answers.employees) > 50) credits = 35;
  
  return credits;
}

// QUESTIONNAIRE FORMS

expert: [
  {
    id: 'services',
    title: 'What services do you provide?',
    subtitle: 'Select all that apply',
    type: 'multi',
    options: [
      { label: 'Income Tax Return (ITR) Filing', icon: 'üìä' },
      { label: 'GST Registration & Filing', icon: 'üßæ' },
      { label: 'Accounting & Bookkeeping', icon: 'üíº' },
      { label: 'Tax Planning & Consulting', icon: 'üìà' },
      { label: 'Company Registration', icon: 'üè¢' },
      { label: 'Audit Services', icon: 'üîç' },
      { label: 'Payroll Management', icon: 'üí∞' },
      { label: 'Financial Consulting', icon: 'üí°' },
      { label: 'Legal Services', icon: '‚öñÔ∏è' },
      { label: 'Other Professional Services', icon: 'üéØ' }
    ]
  },
  {
    id: 'companyName',
    title: 'What is your company name?',
    subtitle: 'Enter your business or firm name',
    type: 'text',
    placeholder: 'e.g., ABC Tax Consultants Pvt Ltd'
  },
  {
    id: 'hasWebsite',
    title: 'Do you have a website?',
    subtitle: 'This helps us understand your digital presence',
    type: 'single',
    options: [
      { label: 'Yes, I have a website', icon: 'üåê' },
      { label: 'No, I don\'t have a website', icon: 'üì±' },
      { label: 'Planning to create one soon', icon: 'üöÄ' }
    ]
  },
  {
    id: 'websiteUrl',
    title: 'Enter your website URL',
    subtitle: 'Optional - Skip if you don\'t have one yet',
    type: 'text',
    placeholder: 'https://www.yourwebsite.com',
    skip: true,
    condition: (answers) => answers.hasWebsite === 'Yes, I have a website'
  },
  {
    id: 'companySize',
    title: 'What is your company size?',
    subtitle: 'Number of team members including you',
    type: 'single',
    options: [
      { label: 'Solo Professional (Just Me)', icon: 'üë§', desc: '1 person' },
      { label: 'Small Team', icon: 'üë•', desc: '2-5 people' },
      { label: 'Medium Team', icon: 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶', desc: '6-20 people' },
      { label: 'Large Organization', icon: 'üè¢', desc: '20+ people' }
    ]
  },
  {
    id: 'experience',
    title: 'How many years of experience do you have?',
    subtitle: 'Your total professional experience',
    type: 'single',
    options: [
      { label: 'Less than 1 year', icon: 'üå±' },
      { label: '1-3 years', icon: 'üåø' },
      { label: '3-5 years', icon: 'üå≥' },
      { label: '5-10 years', icon: 'üéØ' },
      { label: '10+ years', icon: 'üèÜ' }
    ]
  },
  {
    id: 'certifications',
    title: 'Do you have any certifications?',
    subtitle: 'Professional qualifications (select all that apply)',
    type: 'multi',
    options: [
      { label: 'Chartered Accountant (CA)', icon: 'üéì' },
      { label: 'Company Secretary (CS)', icon: 'üìú' },
      { label: 'Cost and Management Accountant (CMA)', icon: 'üíº' },
      { label: 'Certified Public Accountant (CPA)', icon: 'üåç' },
      { label: 'MBA - Finance', icon: 'üéì' },
      { label: 'Tax Practitioner', icon: 'üìä' },
      { label: 'Legal Practitioner', icon: '‚öñÔ∏è' },
      { label: 'Other Professional Certification', icon: '‚úÖ' },
      { label: 'No formal certification', icon: 'üí™' }
    ]
  }
]
const Q_FORMS = {
  service: {
    title: "What service do you need?",
    subtitle: "Select the category",
    type: "single",
    key: "service",
    options: [
      { value: "itr", icon: "üìÑ", label: "ITR Filing", desc: "Income Tax Return" },
      { value: "gst", icon: "üè¢", label: "GST Services", desc: "Registration, filing" },
      { value: "accounting", icon: "üìä", label: "Accounting", desc: "Bookkeeping" },
      { value: "audit", icon: "üîç", label: "Audit Services", desc: "Statutory audit" },
      { value: "photography", icon: "üì∏", label: "Photography", desc: "Events, product" },
      { value: "development", icon: "üíª", label: "App/Web Dev", desc: "Build digital products" }
    ]
  },
  
  // ITR (simplified - showing key questions)
  itr_for: { condition: { service: "itr" }, title: "Who is the return for?", type: "single", key: "itrFor", options: [{ value: "individual", label: "Individual" }, { value: "freelancer", label: "Freelancer" }, { value: "business", label: "Business" }] },
  itr_income_source: { condition: { service: "itr" }, title: "Sources of income?", subtitle: "Select all", type: "multi", key: "incomeSource", options: [{ value: "salary", label: "Salary" }, { value: "business", label: "Business" }, { value: "rental", label: "Rental" }, { value: "capital", label: "Capital Gains" }, { value: "other", label: "Other" }] },
  itr_income_bracket: { condition: { service: "itr" }, title: "Annual income?", type: "single", key: "incomeBracket", options: [{ value: "below5", label: "Below ‚Çπ5L" }, { value: "5-10", label: "‚Çπ5-10L" }, { value: "10-15", label: "‚Çπ10-15L" }, { value: "15-20", label: "‚Çπ15-20L" }, { value: "20-25", label: "‚Çπ20-25L" }, { value: "25+", label: ">‚Çπ25L" }] },
  
  // GST (simplified)
  gst_service: { condition: { service: "gst" }, title: "What GST service?", type: "single", key: "gstService", options: [{ value: "registration", label: "New Registration" }, { value: "monthly", label: "Monthly Filing" }, { value: "annual", label: "Annual Return" }] },
  gst_turnover: { condition: { service: "gst" }, title: "Annual turnover?", type: "single", key: "turnover", options: [{ value: "below20", label: "< ‚Çπ20L" }, { value: "20-1cr", label: "‚Çπ20L-1Cr" }, { value: "1-5cr", label: "‚Çπ1-5Cr" }, { value: "20cr+", label: "‚Çπ20Cr+" }] },
  
  // Common
  timeline: { title: "When do you need this?", type: "single", key: "timeline", options: [{ value: "immediate", icon: "üî¥", label: "Immediate" }, { value: "week", icon: "üü†", label: "Within week" }, { value: "month", icon: "üü°", label: "Within month" }, { value: "flexible", icon: "üü¢", label: "Flexible" }] },
  budget: { title: "Budget range?", subtitle: "Select amount", type: "single", key: "budget", options: [
    { value: "500", label: "‚Çπ500" }, { value: "1000", label: "‚Çπ1,000" }, { value: "1500", label: "‚Çπ1,500" }, 
    { value: "2000", label: "‚Çπ2,000" }, { value: "2500", label: "‚Çπ2,500" }, { value: "3000", label: "‚Çπ3,000" },
    { value: "3500", label: "‚Çπ3,500" }, { value: "4000", label: "‚Çπ4,000" }, { value: "4500", label: "‚Çπ4,500" },
    { value: "5000", label: "‚Çπ5,000" }, { value: "6000", label: "‚Çπ6,000" }, { value: "7000", label: "‚Çπ7,000" },
    { value: "8000", label: "‚Çπ8,000" }, { value: "9000", label: "‚Çπ9,000" }, { value: "10000", label: "‚Çπ10,000" },
    { value: "12000", label: "‚Çπ12,000" }, { value: "15000", label: "‚Çπ15,000" }, { value: "20000", label: "‚Çπ20,000" }
  ] },
  details: { title: "Additional details", type: "textarea", key: "details", placeholder: "Describe your requirement..." },
  location: { title: "Your location", type: "input", key: "location", inputType: "text", placeholder: "City, State" }
};

function buildQuestionSequence() {
  const service = state.qAnswers.service;
  let seq = ['service'];
  
  if (service === 'itr') seq.push('itr_for', 'itr_income_source', 'itr_income_bracket');
  else if (service === 'gst') seq.push('gst_service', 'gst_turnover');
  
  seq.push('timeline', 'budget', 'details', 'location');
  return seq;
}

// HELPERS
function goPage(id) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  window.scrollTo(0, 0);
}

function goAuth(mode, role) {
  state.authMode = mode;
  if (role) state.role = role;
  switchAuth(mode);
  if (role) pickRole(role);
  goPage('auth');
}

function switchAuth(mode) {
  state.authMode = mode;
  document.getElementById('toggleLogin').classList.toggle('active', mode === 'login');
  document.getElementById('toggleSignup').classList.toggle('active', mode === 'signup');
  document.getElementById('nameField').style.display = mode === 'signup' ? 'block' : 'none';
  document.getElementById('authSubmit').textContent = mode === 'signup' ? 'Create Account' : 'Log In';
  document.getElementById('authFooter').innerHTML = mode === 'signup' ? 'Already have an account? <a onclick="switchAuth(\'login\')">Log in</a>' : 'No account? <a onclick="switchAuth(\'signup\')">Sign up</a>';
  document.getElementById('authForm').style.display = 'block';
  document.getElementById('verifyForm').style.display = 'none';
}

function pickRole(r) {
  state.role = r;
  document.getElementById('roleClient').classList.toggle('active', r === 'client');
  document.getElementById('roleExpert').classList.toggle('active', r === 'expert');
  document.getElementById('authSubmit').classList.remove('disabled');
}

async function submitAuth() {
  if (!state.role) {
    alert('Please select your role');
    return;
  }
  
  const name = document.getElementById('inName').value.trim();
  const email = document.getElementById('inEmail').value.trim();
  const phone = document.getElementById('inPhone').value.trim();
  const password = document.getElementById('inPass').value;
  
  if (!email || !phone || !password) {
    alert('Please fill in all fields');
    return;
  }
  
  if (state.authMode === 'signup' && !name) {
    alert('Please enter your name');
    return;
  }
  
  if (phone.length !== 10) {
    alert('Phone must be 10 digits');
    return;
  }
  
  try {
    if (state.authMode === 'signup') {
      // Register without OTP
      const res = await fetch(`${API_URL}/auth/register`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name, email, phone, password, role: state.role })
      });
      
      const data = await res.json();
      if (!res.ok) throw new Error(data.message || 'Registration failed');
      
      // Auto-verify and login
      state.userId = data.userId;
      state.user = { name, email, phone, role: state.role, credits: 50 };
      state.token = 'temp_token_' + Date.now(); // Temporary token for demo
      state.expertCredits = 50;
      
      localStorage.setItem('token', state.token);
      localStorage.setItem('user', JSON.stringify(state.user));
      
      alert('‚úÖ Account created successfully!');
      
      // Go directly to questionnaire for clients, dashboard for experts
      if (state.role === 'client') {
        startQuestionnaire();
      } else {
        enterDashboard();
      }
    } else {
      // Login
      const res = await fetch(`${API_URL}/auth/login`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, password })
      });
      
      const data = await res.json();
      if (!res.ok) throw new Error(data.message || 'Login failed');
      
      state.token = data.token;
      state.user = data.user;
      state.role = data.user.role;
      state.expertCredits = data.user.credits || 50;
      localStorage.setItem('token', data.token);
      localStorage.setItem('user', JSON.stringify(data.user));
      
      enterDashboard();
    }
  } catch (error) {
    alert(error.message);
  }
}

function startVerify() {
  state.verifyStep = 0;
  document.getElementById('authForm').style.display = 'none';
  document.getElementById('verifyForm').style.display = 'block';
  updateVerifyUI();
}

function updateVerifyUI() {
  const step = state.verifyStep;
  document.getElementById('vStep0').classList.toggle('done', true);
  document.getElementById('vStep1').classList.toggle('done', step > 0);
  document.getElementById('verifyTitle').textContent = step === 0 ? 'Verify Email' : 'Verify Phone';
  document.getElementById('verifySub').textContent = step === 0 ? `Code sent to ${state.user.email}` : `Code sent to +91 ${state.user.phone}`;
  document.getElementById('otpInput').value = '';
}

async function submitVerify() {
  const otp = document.getElementById('otpInput').value.trim();
  
  if (otp.length !== 6) {
    alert('Please enter 6-digit code');
    return;
  }
  
  try {
    if (state.verifyStep === 0) {
      const res = await fetch(`${API_URL}/auth/verify-email`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ userId: state.userId, otp })
      });
      
      const data = await res.json();
      if (!res.ok) throw new Error(data.message || 'Verification failed');
      
      await fetch(`${API_URL}/auth/send-phone-otp`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ userId: state.userId })
      });
      
      state.verifyStep = 1;
      updateVerifyUI();
      alert('Email verified! Check Railway logs for phone OTP code.');
    } else {
      const res = await fetch(`${API_URL}/auth/verify-phone`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ userId: state.userId, otp })
      });
      
      const data = await res.json();
      if (!res.ok) throw new Error(data.message || 'Verification failed');
      
      state.token = data.token;
      state.user = data.user;
      state.role = data.user.role;
      state.expertCredits = data.user.credits || 50;
      localStorage.setItem('token', data.token);
      localStorage.setItem('user', JSON.stringify(data.user));
      
      if (state.role === 'client') startQuestionnaire();
      else enterDashboard();
    }
  } catch (error) {
    alert(error.message);
  }
}

function startQuestionnaire() {
  state.qStep = 0;
  state.qAnswers = {};
  state.qSequence = null;
  renderQStep();
  goPage('questionnaire');
}

function renderQStep() {
  if (!state.qSequence) state.qSequence = state.qStep === 0 ? ['service'] : buildQuestionSequence();
  
  const stepKey = state.qSequence[state.qStep];
  const step = Q_FORMS[stepKey];
  
  if (!step) { completeQuestionnaire(); return; }
  
  function handleNext() {
  const q = QUESTIONNAIRE_DATA[state.role][state.qStep];
  let isValid = false;

  // Check if question has skip condition
  if (q.skip) {
    const skipBtn = document.getElementById('qSkipBtn');
    if (skipBtn && skipBtn.style.display !== 'none') {
      // Allow skipping
      state.qAnswers[q.id] = '';
      isValid = true;
    }
  }

  if (!isValid) {
    if (q.type === 'single') {
      const selected = document.querySelector('.q-option.selected');
      if (selected) {
        state.qAnswers[q.id] = selected.dataset.value;
        isValid = true;
      }
    } else if (q.type === 'multi') {
      const selected = document.querySelectorAll('.chip.selected');
      if (selected.length > 0) {
        state.qAnswers[q.id] = Array.from(selected).map(el => el.dataset.value);
        isValid = true;
      }
    } else if (q.type === 'text') {
      const input = document.getElementById('qTextInput');
      if (input && input.value.trim()) {
        state.qAnswers[q.id] = input.value.trim();
        isValid = true;
      } else if (q.skip) {
        // Allow empty if skippable
        state.qAnswers[q.id] = '';
        isValid = true;
      }
    }
  }

  if (!isValid) {
    alert('‚ö†Ô∏è Please answer the question to continue');
    return;
  }

  // Move to next question or finish
  if (state.qStep < QUESTIONNAIRE_DATA[state.role].length - 1) {
    state.qStep++;
    checkConditionalSkip();
    renderQuestion();
  } else {
    finishQuestionnaire();
  }
} 

function skipQuestion() {
  const q = QUESTIONNAIRE_DATA[state.role][state.qStep];
  state.qAnswers[q.id] = '';
  
  if (state.qStep < QUESTIONNAIRE_DATA[state.role].length - 1) {
    state.qStep++;
    checkConditionalSkip();
    renderQuestion();
  } else {
    finishQuestionnaire();
  }
}

if (step.condition) {
    function checkConditionalSkip() {
  const q = QUESTIONNAIRE_DATA[state.role][state.qStep];
  
  // Check if question has a condition and should be skipped
  if (q.condition && !q.condition(state.qAnswers)) {
    // Skip this question
    if (state.qStep < QUESTIONNAIRE_DATA[state.role].length - 1) {
      state.qStep++;
      checkConditionalSkip(); // Recursively check next question
    } else {
      finishQuestionnaire(); { // Prepare expert profile data if (state.role === 'expert') { state.user.profile = { services: state.qAnswers.services || [],companyName: state.qAnswers.companyName || '', hasWebsite: state.qAnswers.hasWebsite || '', websiteUrl:state.qAnswers.websiteUrl || '', companySize: state.qAnswers.companySize || '', experience: state.qAnswers.experience || '',certifications: state.qAnswers.certifications || [], bio: `Professional with ${state.qAnswers.experience || 'experience'} in ${(state.qAnswers.services || []).join(', ')}`, specialization: (state.qAnswers.services || [])[0] || 'Professional Services' }; }try {
    }
  }
} const [key, val] = Object.entries(step.condition)[0];
    if (state.qAnswers[key] !== val) { state.qStep++; renderQStep(); return; }
  }
  
  const progress = ((state.qStep + 1) / state.qSequence.length) * 100;
  document.getElementById('qProgressFill').style.width = progress + '%';
  document.getElementById('qStepText').textContent = `Step ${state.qStep + 1} of ${state.qSequence.length}`;
  document.getElementById('qBackBtn').style.display = state.qStep > 0 ? 'block' : 'none';
  
  const content = document.getElementById('qContent');
  content.innerHTML = `<div class="q-title">${step.title}</div>${step.subtitle ? `<div class="q-subtitle">${step.subtitle}</div>` : ''}`;
  
  if (step.type === 'single') {
    content.innerHTML += `<div class="q-options">${step.options.map(opt => `<div class="q-option ${state.qAnswers[step.key] === opt.value ? 'selected' : ''}" onclick="selectOption('${step.key}', '${opt.value}')">${opt.icon ? `<div class="opt-icon">${opt.icon}</div>` : ''}<div class="opt-text"><div class="opt-label">${opt.label}</div>${opt.desc ? `<div class="opt-desc">${opt.desc}</div>` : ''}</div></div>`).join('')}</div>`;
  } else if (step.type === 'multi') {
    content.innerHTML += `<div class="chip-grid">${step.options.map(opt => `<div class="chip ${state.qAnswers[step.key] && state.qAnswers[step.key].includes(opt.value) ? 'selected' : ''}" onclick="toggleChip(this, '${step.key}', '${opt.value}')">${opt.label}</div>`).join('')}</div>`;
 document.getElementById('qNextBtn').classList.toggle('disabled', !state. } else if (q.type === 'text') {
  html += `
    <div class="field">
      <input type="text" id="qTextInput" placeholder="${q.placeholder || 'Type your answer...'}" value="${state.qAnswers[q.id] || ''}" ${q.id === 'websiteUrl' ? 'style="text-transform: lowercase;"' : ''}>
    </div>
  `; qAnswers[step.key]);
}

function selectOption(key, value) {
  state.qAnswers[key] = value;
  document.querySelectorAll('.q-option').forEach(opt => opt.classList.remove('selected'));
  event.currentTarget.classList.add('selected');
  document.getElementById('qNextBtn').classList.remove('disabled');
  if (key === 'service') state.qSequence = buildQuestionSequence();
}

function toggleChip(el, key, value) {
  el.classList.toggle('selected');
  if (!state.qAnswers[key]) state.qAnswers[key] = [];
  const idx = state.qAnswers[key].indexOf(value);
  if (idx > -1) state.qAnswers[key].splice(idx, 1); else state.qAnswers[key].push(value);
  document.getElementById('qNextBtn').classList.toggle('disabled', state.qAnswers[key].length === 0);
}

function qInputChange() {
  const val = document.getElementById('qInput').value.trim();
  const step = Q_FORMS[state.qSequence[state.qStep]];
  state.qAnswers[step.key] = val;
  document.getElementById('qNextBtn').classList.toggle('disabled', !val);
}

function qNext() {
  if (document.getElementById('qNextBtn').classList.contains('disabled')) return;
  state.qStep++;
  if (state.qStep >= state.qSequence.length) completeQuestionnaire(); else renderQStep();
}

function qBack() { if (state.qStep > 0) { state.qStep--; renderQStep(); } }

async function completeQuestionnaire() {
  const service = Q_FORMS.service.options.find(o => o.value === state.qAnswers.service);
  const credits = calculateCredits(state.qAnswers.service, state.qAnswers);
  
  const title = service.label + ' - ' + (state.qAnswers.location || 'India');
  const description = state.qAnswers.details || 'Details in questionnaire';
  
  try {
    const res = await fetch(`${API_URL}/requests`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${state.token}`
      },
      body: JSON.stringify({
        service: state.qAnswers.service,
        title,
        description,
        answers: state.qAnswers,
        timeline: state.qAnswers.timeline || 'flexible',
        budget: state.qAnswers.budget || 'Budget TBD',
        location: state.qAnswers.location || 'India'
      })
    });
    
    const data = await res.json();
    if (!res.ok) throw new Error(data.message || 'Failed to create request');
    
    alert('‚úÖ Request posted successfully!');
    enterDashboard();
  } catch (error) {
    alert(error.message);
    enterDashboard();
  }
}

async function loadClientRequests() {
  if (!state.token) return;
  try {
    const res = await fetch(`${API_URL}/requests`, {
      headers: { 'Authorization': `Bearer ${state.token}` }
    });
    const data = await res.json();
    if (res.ok && data.requests) {
      state.clientRequests = data.requests.map(req => ({
        id: req._id,
        title: req.title,
        service: req.service,
        desc: req.description,
        timeline: req.timeline,
        status: req.status,
        location: req.location,
        budget: req.budget,
        posted: new Date(req.createdAt).toLocaleDateString(),
        responses: [],
        credits: req.credits,
        answers: req.answers
      }));
    }
  } catch (error) {
    console.error('Load error:', error);
  }
}

async function loadExpertRequests() {
  if (!state.token) return;
  try {
    const res = await fetch(`${API_URL}/requests`, {
      headers: { 'Authorization': `Bearer ${state.token}` }
    });
    const data = await res.json();
    if (res.ok && data.requests) {
      state.clientRequests = data.requests.map(req => ({
        id: req._id,
        title: req.title,
        service: req.service,
        desc: req.description,
        timeline: req.timeline,
        location: req.location,
        budget: req.budget,
        credits: req.credits
      }));
    }
  } catch (error) {
    console.error('Load error:', error);
  }
}

async function loadExpertApproaches() {
  if (!state.token) return;
  try {
    const res = await fetch(`${API_URL}/approaches`, {
      headers: { 'Authorization': `Bearer ${state.token}` }
    });
    const data = await res.json();
    if (res.ok && data.approaches) {
      state.expertApproaches = data.approaches.map(app => ({
        reqId: app.request._id,
        reqTitle: app.request.title,
        message: app.message,
        unlocked: app.unlocked,
        clientEmail: app.clientEmail,
        clientPhone: app.clientPhone,
        sentTime: new Date(app.createdAt).toLocaleDateString()
      }));
    }
  } catch (error) {
    console.error('Load error:', error);
  }
}

function enterDashboard() {
  if (state.role === 'client') { renderClientDash(); goPage('clientDash'); }
  else { renderExpertDash(); goPage('expertDash'); }
}

// CLIENT DASHBOARD
async function renderClientDash() {
  const initials = state.user.name.split(' ').map(n => n[0]).join('');
  document.getElementById('clientAvatar').textContent = initials;
  document.getElementById('clientProfAvatar').textContent = initials;
  document.getElementById('clientProfName').textContent = state.user.name;
  document.getElementById('clientProfEmail').textContent = state.user.email;
  document.getElementById('clientProfPhone').textContent = '+91 ' + state.user.phone;
  await loadClientRequests();
  clientSwitchTab('requests');
}

function clientSwitchTab(tab) {
  document.getElementById('clientTabRequests').style.display = tab === 'requests' ? 'block' : 'none';
  document.getElementById('clientTabProfile').style.display = tab === 'profile' ? 'block' : 'none';
  document.getElementById('clientNavReq').classList.toggle('active', tab === 'requests');
  document.getElementById('clientNavProf').classList.toggle('active', tab === 'profile');
  if (tab === 'requests') renderClientRequests();
}

function renderClientRequests() {
  const cont = document.getElementById('clientTabRequests');
  const reqs = state.clientRequests;
  
  if (reqs.length === 0) {
    cont.innerHTML = `
      <div class="empty-state">
        <div class="icon">üéØ</div>
        <h3>Ready to get started?</h3>
        <p style="margin-bottom:24px;">Post your first requirement and get expert help</p>
        <button onclick="startQuestionnaire()" style="padding:12px 24px;border-radius:8px;border:none;background:var(--primary);color:#fff;font-size:14px;font-weight:700;cursor:pointer;">
          üìù Post Your First Request
        </button>
      </div>
      
      <div style="padding:20px;">
        <h4 style="font-size:16px;font-weight:700;margin-bottom:16px;color:var(--text);">Popular Services</h4>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
          <div onclick="startQuestionnaire()" style="padding:16px;background:#fff;border:1px solid var(--border);border-radius:12px;cursor:pointer;">
            <div style="font-size:24px;margin-bottom:8px;">üìÑ</div>
            <div style="font-size:13px;font-weight:600;color:var(--text);">ITR Filing</div>
            <div style="font-size:11px;color:var(--text-muted);">From ‚Çπ500</div>
          </div>
          <div onclick="startQuestionnaire()" style="padding:16px;background:#fff;border:1px solid var(--border);border-radius:12px;cursor:pointer;">
            <div style="font-size:24px;margin-bottom:8px;">üè¢</div>
            <div style="font-size:13px;font-weight:600;color:var(--text);">GST Services</div>
            <div style="font-size:11px;color:var(--text-muted);">From ‚Çπ1,000</div>
          </div>
          <div onclick="startQuestionnaire()" style="padding:16px;background:#fff;border:1px solid var(--border);border-radius:12px;cursor:pointer;">
            <div style="font-size:24px;margin-bottom:8px;">üìä</div>
            <div style="font-size:13px;font-weight:600;color:var(--text);">Accounting</div>
            <div style="font-size:11px;color:var(--text-muted);">From ‚Çπ2,000</div>
          </div>
          <div onclick="startQuestionnaire()" style="padding:16px;background:#fff;border:1px solid var(--border);border-radius:12px;cursor:pointer;">
            <div style="font-size:24px;margin-bottom:8px;">üíª</div>
            <div style="font-size:13px;font-weight:600;color:var(--text);">Development</div>
            <div style="font-size:11px;color:var(--text-muted);">From ‚Çπ5,000</div>
          </div>
        </div>
      </div>
    `;
    return;
  }
  
  cont.innerHTML = reqs.map(req => {
    const tLabels = { immediate: 'Urgent', week: 'High', month: 'Medium', flexible: 'Low' };
    const tColors = { immediate: 'var(--red)', week: 'var(--primary)', month: 'var(--yellow)', flexible: 'var(--text-muted)' };
    
    const responsesHTML = req.responses && req.responses.length > 0 ? req.responses.map(resp => `
      <div class="response-card">
        <div class="resp-header">
          <div class="resp-avatar">E</div>
          <div class="resp-info"><h5>${resp.expert}</h5><div class="rating">‚≠ê ${resp.rating}</div></div>
        </div>
        <div class="resp-body">${resp.message}</div>
      </div>
    `).join('') : '<div style="margin-top:12px; text-align:center; font-size:13px; color:var(--text-muted)">Waiting for experts...</div>';
    
    return `
      <div class="req-card">
        <div class="req-top">
          <div class="req-left">
            <h4>${req.title}</h4>
            <div class="meta">${req.posted} ‚Ä¢ ${req.location}</div>
          </div>
          <span class="status-badge ${req.status}">${req.status}</span>
        </div>
        <div class="req-desc">${req.desc}</div>
        <div class="req-footer">
          <span style="font-size:12px; font-weight:600; color:${tColors[req.timeline]}">‚ö° ${tLabels[req.timeline]}</span>
          <span style="font-size:14px; font-weight:700; color:var(--green)">${req.budget}</span>
        </div>
        ${responsesHTML}
      </div>
    `;
  }).join('');
}

// EXPERT DASHBOARD
async function renderExpertDash() {
  const initials = state.user.name.split(' ').map(n => n[0]).join('');
  document.getElementById('expertAvatar').textContent = initials;
  document.getElementById('expertProfAvatar').textContent = initials;
  document.getElementById('expertProfName').textContent = state.user.name;
  document.getElementById('expertCredits').textContent = state.expertCredits;
  
  const pills = '<div class="filter-pill active" onclick="expertFilterCat(\'all\')">All</div><div class="filter-pill" onclick="expertFilterCat(\'itr\')">üìÑ ITR</div><div class="filter-pill" onclick="expertFilterCat(\'gst\')">üè¢ GST</div><div class="filter-pill" onclick="expertFilterCat(\'accounting\')">üìä Accounting</div>';
  document.getElementById('expertFilterPills').innerHTML = pills;
  
  renderExpertProfile();
  
  await loadExpertRequests();
  await loadExpertApproaches();
  expertSwitchTab('browse');
}

function expertSwitchTab(tab) {
  document.getElementById('expertTabBrowse').style.display = tab === 'browse' ? 'block' : 'none';
  document.getElementById('expertTabApproaches').style.display = tab === 'approaches' ? 'block' : 'none';
  document.getElementById('expertTabProfile').style.display = tab === 'profile' ? 'block' : 'none';
  document.getElementById('expertNavBrowse').classList.toggle('active', tab === 'browse');
  document.getElementById('expertNavApp').classList.toggle('active', tab === 'approaches');
  document.getElementById('expertNavProf').classList.toggle('active', tab === 'profile');
  if (tab === 'browse') expertRenderBrowse();
  else if (tab === 'approaches') expertRenderApproaches();
}

function expertFilterCat(cat) {
  document.querySelectorAll('.filter-pill').forEach(p => p.classList.remove('active'));
  event.currentTarget.classList.add('active');
  expertRenderBrowse(cat);
}

function expertRenderBrowse(cat = 'all') {
  const list = document.getElementById('expertBrowseList');
  const filtered = cat === 'all' ? state.clientRequests : state.clientRequests.filter(r => r.service === cat);
  
  if (filtered.length === 0) {
    list.innerHTML = '<div class="empty-state"><div class="icon">üîç</div><h3>No requirements yet</h3><p>Check back soon for new opportunities</p></div>';
    return;
  }
  
  list.innerHTML = filtered.map(req => {
    const icons = { itr: 'üìÑ', gst: 'üè¢', accounting: 'üìä', audit: 'üîç', photography: 'üì∏', development: 'üíª' };
    const isUnlocked = state.unlockedRequests.includes(req.id);
    const approachCount = req.approachCount || 0;
    const maxApproaches = 5;
    
    return `
      <div class="browse-card" onclick="openUnlockModal('${req.id}')">
        <div class="browse-credit">üíé ${req.credits}</div>
        <div class="browse-top">
          <div class="browse-cat">
            <span class="cat-icon">${icons[req.service] || 'üìÑ'}</span>
            <h4>${req.title}</h4>
          </div>
        </div>
        <div class="browse-desc">${req.desc}</div>
        <div class="browse-footer">
          <span style="font-size:12px; color:var(--text-muted)">üìç ${req.location}</span>
          <span style="font-size:14px; font-weight:700; color:var(--green)">‚Çπ${req.budget}</span>
        </div>
        <div style="margin-top:10px;display:flex;justify-content:space-between;align-items:center;">
          <span style="font-size:11px;color:var(--text-muted)">üë• ${approachCount}/${maxApproaches} approaches</span>
          ${isUnlocked ? '<span style="font-size:12px; color:var(--green); font-weight:600;">‚úì Unlocked</span>' : ''}
        </div>
      </div>
    `;
  }).join('');
}

function expertRenderApproaches() {
  const cont = document.getElementById('expertTabApproaches');
  
  if (state.expertApproaches.length === 0) {
    cont.innerHTML = '<div class="empty-state"><div class="icon">üí¨</div><h3>No approaches yet</h3><p>Browse and send your first approach</p></div>';
    return;
  }
  
  cont.innerHTML = state.expertApproaches.map(app => {
    const isUnlocked = app.unlocked;
    return `
      <div class="approach-card">
        <div class="approach-header">
          <h4>${app.reqTitle}</h4>
          <span class="approach-status ${isUnlocked ? 'unlocked' : 'sent'}">${isUnlocked ? 'unlocked' : 'sent'}</span>
        </div>
        <div style="font-size:13px; color:var(--text-light); margin-bottom:8px;">${app.message}</div>
        <div style="font-size:12px; color:var(--text-muted)">Sent ${app.sentTime}</div>
        ${isUnlocked ? `<div class="contact-info"><h5>Client Contact</h5><p>üìß ${app.clientEmail}</p><p>üì± ${app.clientPhone}</p></div>` : ''}
      </div>
    `;
  }).join('');
}

// UNLOCK MODAL
function openUnlockModal(reqId) {
  const req = state.clientRequests.find(r => r.id === reqId);
  if (!req) return;
  
  const isUnlocked = state.unlockedRequests.includes(reqId);
  const approachCount = req.approachCount || 0;
  const maxApproaches = 5;
  
  if (isUnlocked) {
    const approach = state.expertApproaches.find(a => a.reqId === reqId);
    const content = `
      <div class="modal-title">Contact Details</div>
      <div class="contact-info">
        <h5>Client Info</h5>
        <p>üìß ${approach?.clientEmail || 'email@example.com'}</p>
        <p>üì± ${approach?.clientPhone || '+91 9876543210'}</p>
      </div>
      <button class="submit-btn" onclick="closeModal()">Done</button>
    `;
    document.getElementById('modalContent').innerHTML = content;
  } else {
    // Show masked preview with unlock option
    const maskedEmail = '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢@‚Ä¢‚Ä¢‚Ä¢‚Ä¢.com';
    const maskedPhone = '+91 ‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢';
    
    const content = `
      <div class="modal-title">${req.title}</div>
      <div class="modal-subtitle">Preview - Unlock to see full details</div>
      
      <div style="background:var(--bg-gray);padding:16px;border-radius:12px;margin-bottom:16px;">
        <div style="margin-bottom:12px;">
          <h5 style="font-size:13px;color:var(--text-muted);margin-bottom:4px;">Description</h5>
          <p style="font-size:14px;color:var(--text);">${req.desc || 'No description'}</p>
        </div>
        <div style="margin-bottom:12px;">
          <h5 style="font-size:13px;color:var(--text-muted);margin-bottom:4px;">Location</h5>
          <p style="font-size:14px;color:var(--text);">üìç ${req.location}</p>
        </div>
        <div style="margin-bottom:12px;">
          <h5 style="font-size:13px;color:var(--text-muted);margin-bottom:4px;">Budget</h5>
          <p style="font-size:14px;color:var(--green);font-weight:700;">‚Çπ${req.budget}</p>
        </div>
        <div style="border-top:1px solid var(--border);padding-top:12px;margin-top:12px;">
          <h5 style="font-size:13px;color:var(--text-muted);margin-bottom:8px;">Contact (Locked)</h5>
          <p style="font-size:14px;color:var(--text-muted);">üìß ${maskedEmail}</p>
          <p style="font-size:14px;color:var(--text-muted);">üì± ${maskedPhone}</p>
        </div>
      </div>
      
      <div style="background:#FFF4ED;padding:12px;border-radius:8px;margin-bottom:16px;font-size:13px;color:var(--text);">
        üë• ${approachCount}/${maxApproaches} experts have approached this client
      </div>
      
      ${approachCount >= maxApproaches ? `
        <div style="background:#FFEBEE;padding:12px;border-radius:8px;margin-bottom:16px;font-size:13px;color:#C62828;">
          ‚ö†Ô∏è Maximum approaches reached. This requirement is no longer accepting new approaches.
        </div>
        <button class="submit-btn" style="background:#ccc;" disabled>Limit Reached</button>
      ` : `
        <div class="field">
          <label>Your Approach Message</label>
          <textarea id="approachMsg" rows="3" placeholder="Introduce yourself and explain how you can help..."></textarea>
        </div>
        <div style="text-align:center;font-size:13px;color:var(--text-muted);margin-bottom:16px;">
          Cost: <strong style="color:var(--primary)">${req.credits} credits</strong> | 
          After unlock: <strong style="color:var(--green)">${state.expertCredits - req.credits} credits</strong>
        </div>
        <button class="submit-btn" onclick="confirmUnlock('${reqId}', ${req.credits})">
          Unlock Contact & Send Approach (${req.credits} credits)
        </button>
      `}
      <button class="btn-outline" style="width:100%;margin-top:10px;" onclick="closeModal()">Cancel</button>
    `;
    document.getElementById('modalContent').innerHTML = content;
  }
  
  document.getElementById('modal').classList.add('open');
}

async function confirmUnlock(reqId, credits) {
  if (state.expertCredits < credits) { closeModal(); openBuyCredits(); return; }
  
  const msg = document.getElementById('approachMsg').value;
  if (!msg.trim()) { alert('Please enter your message'); return; }
  
  try {
    const res = await fetch(`${API_URL}/approaches`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${state.token}`
      },
      body: JSON.stringify({
        requestId: reqId,
        message: msg
      })
    });
    
    const data = await res.json();
    if (!res.ok) throw new Error(data.message || 'Failed to send approach');
    
    state.expertCredits = data.remainingCredits;
    state.unlockedRequests.push(reqId);
    document.getElementById('expertCredits').textContent = state.expertCredits;
    
    await loadExpertApproaches();
    closeModal();
    expertSwitchTab('approaches');
    alert(`‚úÖ Approach sent!\n\nClient Email: ${data.approach.clientEmail}\nClient Phone: ${data.approach.clientPhone}`);
  } catch (error) {
    alert(error.message);
  }
}

// BUY CREDITS
function openBuyCredits() {
  const content = `
    <div class="modal-title">Buy Credits</div>
    <div class="modal-subtitle">‚Çπ30 per credit ‚Ä¢ Unlock client requirements</div>
    <div style="margin-bottom:16px; font-size:13px; color:var(--green); font-weight:700;">Current balance: ${state.expertCredits} credits</div>
    ${CREDIT_PACKS.map(p => `
      <div class="credit-pack ${p.popular ? 'popular' : ''}" onclick="selectCreditPack(${p.credits}, ${p.price})">
        ${p.popular ? '<div class="badge">Popular</div>' : ''}
        <div class="amount">${p.credits}</div>
        <div class="credits">Credits</div>
        <div class="price">‚Çπ${p.price}</div>
        <div class="per-credit">‚Çπ${(p.price / p.credits).toFixed(0)} per credit</div>
        ${p.savings > 0 ? `<div class="savings">Save ${p.savings}%</div>` : ''}
      </div>
    `).join('')}
  `;
  document.getElementById('modalContent').innerHTML = content;
  document.getElementById('modal').classList.add('open');
}

function selectCreditPack(credits, price) {
  const content = `
    <div class="modal-title">Complete Payment</div>
    <div class="modal-subtitle">Pay ‚Çπ${price} to get ${credits} credits</div>
    
    <div style="background:var(--bg-gray);padding:16px;border-radius:12px;margin-bottom:20px;">
      <div style="display:flex;justify-content:space-between;margin-bottom:8px;">
        <span style="color:var(--text-muted);">Credits</span>
        <span style="font-weight:700;">${credits}</span>
      </div>
      <div style="display:flex;justify-content:space-between;margin-bottom:8px;">
        <span style="color:var(--text-muted);">Amount</span>
        <span style="font-weight:700;">‚Çπ${price}</span>
      </div>
      <div style="border-top:1px solid var(--border);padding-top:8px;margin-top:8px;display:flex;justify-content:space-between;">
        <span style="color:var(--text);font-weight:600;">Total</span>
        <span style="font-weight:700;color:var(--primary);font-size:18px;">‚Çπ${price}</span>
      </div>
    </div>
    
    <div style="margin-bottom:20px;">
      <label style="font-size:13px;font-weight:600;color:var(--text);display:block;margin-bottom:8px;">Payment Method</label>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
        <button onclick="processUPIPayment(${credits}, ${price}, 'gpay')" style="padding:12px;border:2px solid var(--border);border-radius:8px;background:#fff;cursor:pointer;display:flex;flex-direction:column;align-items:center;gap:6px;">
          <span style="font-size:24px;">üì±</span>
          <span style="font-size:12px;font-weight:600;">Google Pay</span>
        </button>
        <button onclick="processUPIPayment(${credits}, ${price}, 'paytm')" style="padding:12px;border:2px solid var(--border);border-radius:8px;background:#fff;cursor:pointer;display:flex;flex-direction:column;align-items:center;gap:6px;">
          <span style="font-size:24px;">üí≥</span>
          <span style="font-size:12px;font-weight:600;">Paytm</span>
        </button>
        <button onclick="processUPIPayment(${credits}, ${price}, 'phonepe')" style="padding:12px;border:2px solid var(--border);border-radius:8px;background:#fff;cursor:pointer;display:flex;flex-direction:column;align-items:center;gap:6px;">
          <span style="font-size:24px;">üí∞</span>
          <span style="font-size:12px;font-weight:600;">PhonePe</span>
        </button>
        <button onclick="showUPIInput(${credits}, ${price})" style="padding:12px;border:2px solid var(--border);border-radius:8px;background:#fff;cursor:pointer;display:flex;flex-direction:column;align-items:center;gap:6px;">
          <span style="font-size:24px;">üîó</span>
          <span style="font-size:12px;font-weight:600;">UPI ID</span>
        </button>
      </div>
    </div>
    
    <button class="btn-outline" style="width:100%;" onclick="openBuyCredits()">‚Üê Back to Packs</button>
  `;
  document.getElementById('modalContent').innerHTML = content;
}

function showUPIInput(credits, price) {
  const content = `
    <div class="modal-title">Enter UPI ID</div>
    <div class="modal-subtitle">Pay ‚Çπ${price} for ${credits} credits</div>
    
    <div class="field">
      <label>UPI ID</label>
      <input type="text" id="upiId" placeholder="yourname@paytm" style="width:100%;padding:12px;border:1px solid var(--border);border-radius:8px;font-size:14px;">
    </div>
    
    <div style="background:#FFF4ED;padding:12px;border-radius:8px;margin-bottom:16px;font-size:12px;color:var(--text);">
      üí° You'll be redirected to your UPI app to complete payment
    </div>
    
    <button class="submit-btn" onclick="processUPIPayment(${credits}, ${price}, 'upi')">
      Proceed to Payment (‚Çπ${price})
    </button>
    <button class="btn-outline" style="width:100%;margin-top:10px;" onclick="selectCreditPack(${credits}, ${price})">Cancel</button>
  `;
  document.getElementById('modalContent').innerHTML = content;
}

function processUPIPayment(credits, price, method) {
  const upiId = document.getElementById('upiId')?.value || '';
  
  // Demo: Simulate payment success
  const paymentId = 'TXN' + Date.now();
  
  alert(`üîÑ Processing payment of ‚Çπ${price} via ${method.toUpperCase()}...\n\nTransaction ID: ${paymentId}\n\nThis is a demo. In production, this will integrate with a real payment gateway.`);
  
  setTimeout(() => {
    state.expertCredits += credits;
    document.getElementById('expertCredits').textContent = state.expertCredits;
    
    // Update user credits in localStorage
    if (state.user) {
      state.user.credits = state.expertCredits;
      localStorage.setItem('user', JSON.stringify(state.user));
    }
    
    closeModal();
    alert(`‚úÖ Payment Successful!\n\n${credits} credits added to your account.\nNew balance: ${state.expertCredits} credits`);
  }, 1500);
}

function buyCredits(credits, price) {
  state.expertCredits += credits;
  document.getElementById('expertCredits').textContent = state.expertCredits;
  closeModal();
  alert(`‚úÖ Successfully purchased ${credits} credits for ‚Çπ${price}!`);
}

function closeModal() { 
  document.getElementById('modal').classList.remove('open'); 
}

// EXPERT PROFILE EDITING
function renderExpertProfile() {
  const profile = state.user.profile || {
    bio: '',
    specialization: '',
    experience: '',
    certifications: '',
    skills: []
  };
  
  const content = `
    <div class="section-title" style="margin-top:20px;">About</div>
    <div class="qual-item">
      <p style="color:var(--text);line-height:1.6;">${profile.bio || 'Add a bio to tell clients about yourself'}</p>
    </div>
    
    <div class="section-title" style="margin-top:16px;">Professional Details</div>
    <div class="qual-item">
      <h5>Specialization</h5>
      <p>${profile.specialization || 'Not specified'}</p>
    </div>
    <div class="qual-item">
      <h5>Experience</h5>
      <p>${profile.experience || 'Not specified'}</p>
    </div>
    <div class="qual-item">
      <h5>Certifications</h5>
      <p>${profile.certifications || 'No certifications added'}</p>
    </div>
    
    ${profile.skills && profile.skills.length > 0 ? `
      <div class="section-title" style="margin-top:16px;">Skills</div>
      <div style="display:flex;flex-wrap:wrap;gap:8px;margin-top:8px;">
        ${profile.skills.map(skill => `
          <span style="padding:6px 12px;background:var(--bg-gray);border:1px solid var(--border);border-radius:16px;font-size:12px;color:var(--text);">${skill}</span>
        `).join('')}
      </div>
    ` : ''}
    
    <div class="section-title" style="margin-top:16px;">Contact</div>
    <div class="qual-item">
      <h5>Email</h5>
      <p id="expertProfEmail">${state.user.email}</p>
    </div>
    <div class="qual-item">
      <h5>Phone</h5>
      <p id="expertProfPhone">+91 ${state.user.phone}</p>
    </div>
  `;
  
  document.getElementById('expertProfileContent').innerHTML = content;
  document.getElementById('expertProfSpec').textContent = profile.specialization || 'Add your specialization';
}

function openEditProfile() {
  const profile = state.user.profile || {};
  
  const content = `
    <div class="modal-title">Edit Profile</div>
    <div class="modal-subtitle">Update your professional information</div>
    
    <div class="field">
      <label>Bio</label>
      <textarea id="editBio" rows="3" placeholder="Tell clients about yourself...">${profile.bio || ''}</textarea>
    </div>
    
    <div class="field">
      <label>Specialization</label>
      <input type="text" id="editSpec" placeholder="e.g., CA, Tax Consultant, Developer" value="${profile.specialization || ''}">
    </div>
    
    <div class="field">
      <label>Years of Experience</label>
      <input type="text" id="editExp" placeholder="e.g., 5+ years" value="${profile.experience || ''}">
    </div>
    
    <div class="field">
      <label>Certifications</label>
      <textarea id="editCert" rows="2" placeholder="e.g., CA, CPA, Certified Professional">${profile.certifications || ''}</textarea>
    </div>
    
    <div class="field">
      <label>Skills (comma separated)</label>
      <input type="text" id="editSkills" placeholder="e.g., Tax Planning, GST, Audit" value="${profile.skills ? profile.skills.join(', ') : ''}">
    </div>
    
    <button class="submit-btn" onclick="saveProfile()">Save Changes</button>
    <button class="btn-outline" style="width:100%;margin-top:10px;" onclick="closeModal()">Cancel</button>
  `;
  
  document.getElementById('modalContent').innerHTML = content;
  document.getElementById('modal').classList.add('open');
}

function saveProfile() {
  const bio = document.getElementById('editBio').value.trim();
  const specialization = document.getElementById('editSpec').value.trim();
  const experience = document.getElementById('editExp').value.trim();
  const certifications = document.getElementById('editCert').value.trim();
  const skillsStr = document.getElementById('editSkills').value.trim();
  const skills = skillsStr ? skillsStr.split(',').map(s => s.trim()).filter(s => s) : [];
  
  state.user.profile = {
    bio,
    specialization,
    experience,
    certifications,
    skills
  };
  
  localStorage.setItem('user', JSON.stringify(state.user));
  
  renderExpertProfile();
  closeModal();
  alert('‚úÖ Profile updated successfully!');
}

function logout() {
  if (confirm('Are you sure you want to logout?')) {
    localStorage.clear();
    state = {
      role: null,
      user: null,
      userId: null,
      token: null,
      authMode: 'login',
      verifyStep: 0,
      qStep: 0,
      qAnswers: {},
      qSequence: null,
      clientRequests: [],
      expertApproaches: [],
      expertCredits: 50,
      unlockedRequests: []
    };
    goPage('landing');
  }
}

// AUTO-LOGIN ON PAGE LOAD
window.addEventListener('load', async () => {
  const token = localStorage.getItem('token');
  const user = localStorage.getItem('user');
  
  if (token && user) {
    state.token = token;
    state.user = JSON.parse(user);
    state.role = state.user.role;
    state.expertCredits = state.user.credits || 50;
    enterDashboard();
  }
});
</script>
</body>
</html>
