<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"/>
<meta name="theme-color" content="#FC8019"/>
<title>WorkIndex</title>
<style>

/* ‚îÄ‚îÄ‚îÄ RESET ‚îÄ‚îÄ‚îÄ */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
html, body { height: 100%; overscroll-behavior: none; }
body {
  font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', system-ui, sans-serif;
  background: #fff; color: #3D4152;
  min-height: 100vh; min-height: 100dvh;
  overflow-x: hidden;
  -webkit-font-smoothing: antialiased;
}

:root {
  --primary: #FC8019;
  --primary-dark: #E67417;
  --bg: #FFFFFF;
  --bg-gray: #F9FAFB;
  --border: #E9E9EB;
  --text: #3D4152;
  --text-light: #686B78;
  --text-muted: #93959F;
  --green: #48C479;
  --red: #E74C3C;
  --yellow: #F5C518;
  --safe-top: env(safe-area-inset-top, 44px);
  --safe-bot: env(safe-area-inset-bottom, 34px);
}

.page { display: none; min-height: 100vh; animation: fadeIn .25s ease; }
.page.active { display: block; }
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

/* ‚ïê‚ïê‚ïê LANDING ‚ïê‚ïê‚ïê */
#landing { background: linear-gradient(135deg, #FFFAF6 0%, #FFF 100%); padding-top: var(--safe-top); }
.land-nav { display: flex; justify-content: space-between; align-items: center; padding: 16px 20px; }
.logo { display: flex; align-items: center; gap: 8px; }
.logo-icon { width: 36px; height: 36px; background: var(--primary); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 18px; color: #fff; }
.logo-text { font-size: 20px; font-weight: 800; color: var(--text); }

.land-btns { display: flex; gap: 8px; }
.btn-outline { padding: 8px 16px; border: 1.5px solid var(--border); border-radius: 8px; background: transparent; color: var(--text); font-size: 13px; font-weight: 600; cursor: pointer; }
.btn-primary { padding: 8px 16px; border: none; border-radius: 8px; background: var(--primary); color: #fff; font-size: 13px; font-weight: 700; cursor: pointer; }
.btn-primary:active, .btn-outline:active { opacity: 0.8; }

.hero { text-align: center; padding: 60px 24px 40px; }
.hero-badge { display: inline-flex; align-items: center; gap: 6px; background: #FFF4ED; border: 1px solid #FFDCC7; border-radius: 24px; padding: 6px 14px; margin-bottom: 20px; }
.hero-badge .dot { width: 6px; height: 6px; border-radius: 50%; background: var(--green); animation: pulse 2s infinite; }
@keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
.hero-badge span { font-size: 12px; color: var(--primary); font-weight: 600; }

.hero h1 { font-size: clamp(28px, 7vw, 46px); font-weight: 800; line-height: 1.15; letter-spacing: -0.5px; color: var(--text); margin-bottom: 14px; }
.hero .highlight { color: var(--primary); }
.hero p { font-size: 15px; color: var(--text-light); line-height: 1.6; max-width: 340px; margin: 0 auto 32px; }

.hero-actions { display: flex; flex-direction: column; gap: 12px; max-width: 360px; margin: 0 auto; }
.hero-btn { width: 100%; padding: 16px; border-radius: 12px; border: none; font-size: 16px; font-weight: 700; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; transition: transform .15s; }
.hero-btn:active { transform: scale(0.97); }
.hero-btn-orange { background: var(--primary); color: #fff; box-shadow: 0 4px 16px rgba(252,128,25,0.25); }
.hero-btn-white { background: #fff; border: 1.5px solid var(--border) !important; color: var(--text); }

.features { padding: 40px 20px 60px; }
.features h2 { text-align: center; font-size: 22px; font-weight: 700; color: var(--text); margin-bottom: 24px; }
.feat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
.feat-card { background: #fff; border: 1px solid var(--border); border-radius: 14px; padding: 20px 16px; text-align: center; }
.feat-card .icon { font-size: 32px; margin-bottom: 10px; }
.feat-card h4 { font-size: 14px; font-weight: 700; color: var(--text); margin-bottom: 4px; }
.feat-card p { font-size: 12px; color: var(--text-muted); line-height: 1.4; }

/* ‚ïê‚ïê‚ïê AUTH ‚ïê‚ïê‚ïê */
#auth { background: #fff; padding-top: var(--safe-top); min-height: 100vh; }
.auth-back { margin: 14px 20px 0; display: flex; align-items: center; gap: 5px; background: none; border: none; color: var(--text-light); font-size: 14px; font-weight: 600; cursor: pointer; }
.auth-wrap { padding: 32px 20px 60px; }
.auth-logo { text-align: center; margin-bottom: 32px; }
.auth-logo .logo-icon { width: 44px; height: 44px; font-size: 20px; margin: 0 auto 12px; }
.auth-card { background: #fff; border: 1px solid var(--border); border-radius: 16px; padding: 24px 20px; }

.auth-toggle { display: flex; background: var(--bg-gray); border-radius: 10px; padding: 4px; margin-bottom: 24px; }
.auth-toggle button { flex: 1; padding: 10px; border-radius: 8px; border: none; background: transparent; color: var(--text-muted); font-size: 14px; font-weight: 700; cursor: pointer; transition: all .2s; }
.auth-toggle button.active { background: #fff; color: var(--text); box-shadow: 0 2px 4px rgba(0,0,0,0.06); }

.role-pick { display: flex; gap: 12px; margin-bottom: 24px; }
.role-card { flex: 1; padding: 18px 12px; border: 2px solid var(--border); border-radius: 12px; background: #fff; text-align: center; cursor: pointer; transition: all .2s; }
.role-card.active { border-color: var(--primary); background: #FFF4ED; }
.role-card .r-icon { font-size: 28px; margin-bottom: 6px; }
.role-card .r-label { font-size: 14px; font-weight: 700; color: var(--text); }

.field { margin-bottom: 16px; }
.field label { font-size: 13px; font-weight: 600; color: var(--text); display: block; margin-bottom: 6px; }
.field input, .field select, .field textarea { width: 100%; padding: 12px 14px; background: var(--bg-gray); border: 1px solid var(--border); border-radius: 10px; color: var(--text); font-size: 15px; outline: none; font-family: inherit; }
.field input:focus, .field select:focus, .field textarea:focus { border-color: var(--primary); background: #fff; }
.field textarea { resize: none; }
.phone-row { display: flex; gap: 8px; }
.phone-prefix { padding: 12px 12px; background: var(--bg-gray); border: 1px solid var(--border); border-radius: 10px; color: var(--text-light); font-size: 15px; font-weight: 600; }

.submit-btn { width: 100%; padding: 14px; border-radius: 10px; border: none; background: var(--primary); color: #fff; font-size: 16px; font-weight: 700; cursor: pointer; margin-top: 8px; font-family: inherit; }
.submit-btn:active { opacity: 0.85; }
.submit-btn.disabled { background: #E9E9EB; color: var(--text-muted); cursor: not-allowed; }

.auth-footer { text-align: center; margin-top: 20px; font-size: 13px; color: var(--text-muted); }
.auth-footer a { color: var(--primary); cursor: pointer; font-weight: 600; text-decoration: none; }

.verify-steps { display: flex; justify-content: center; gap: 8px; margin-bottom: 24px; }
.v-step { flex: 1; max-width: 100px; height: 4px; border-radius: 2px; background: var(--border); transition: background .3s; }
.v-step.done { background: var(--primary); }
.verify-title { text-align: center; font-size: 22px; font-weight: 700; margin-bottom: 8px; color: var(--text); }
.verify-sub { text-align: center; font-size: 14px; color: var(--text-light); margin-bottom: 24px; }
.otp-input { width: 100%; padding: 16px; text-align: center; letter-spacing: 8px; font-size: 22px; font-weight: 700; background: var(--bg-gray); border: 1px solid var(--border); border-radius: 12px; color: var(--text); outline: none; font-family: 'Courier New', monospace; }
.otp-input:focus { border-color: var(--primary); background: #fff; }
.resend { text-align: center; color: var(--primary); font-size: 14px; font-weight: 600; cursor: pointer; margin: 14px 0 20px; }

/* ‚ïê‚ïê‚ïê QUESTIONNAIRE ‚ïê‚ïê‚ïê */
#questionnaire { background: #fff; padding-top: var(--safe-top); min-height: 100vh; padding-bottom: 80px; }
.q-progress { background: var(--bg-gray); padding: 16px 20px; border-bottom: 1px solid var(--border); }
.q-progress-bar { height: 6px; background: var(--border); border-radius: 3px; overflow: hidden; }
.q-progress-fill { height: 100%; background: var(--primary); border-radius: 3px; transition: width .3s; }
.q-step-text { font-size: 12px; color: var(--text-muted); margin-top: 6px; }

.q-content { padding: 28px 20px; }
.q-title { font-size: 20px; font-weight: 700; color: var(--text); margin-bottom: 8px; }
.q-subtitle { font-size: 14px; color: var(--text-light); margin-bottom: 24px; }

.q-options { display: flex; flex-direction: column; gap: 10px; }
.q-option { padding: 16px; border: 2px solid var(--border); border-radius: 12px; background: #fff; text-align: left; cursor: pointer; transition: all .2s; display: flex; align-items: center; gap: 12px; }
.q-option:active { transform: scale(0.98); }
.q-option.selected { border-color: var(--primary); background: #FFF4ED; }
.q-option .opt-icon { font-size: 24px; flex-shrink: 0; }
.q-option .opt-text { flex: 1; }
.q-option .opt-label { font-size: 15px; font-weight: 700; color: var(--text); }
.q-option .opt-desc { font-size: 12px; color: var(--text-muted); margin-top: 2px; }

.q-nav { position: fixed; bottom: 0; left: 0; right: 0; background: #fff; border-top: 1px solid var(--border); padding: 12px 20px; padding-bottom: calc(12px + var(--safe-bot)); display: flex; gap: 10px; }
.q-btn-back { flex: 0 0 auto; padding: 12px 20px; border: 1px solid var(--border); border-radius: 10px; background: #fff; color: var(--text); font-size: 15px; font-weight: 600; cursor: pointer; font-family: inherit; }
.q-btn-next { flex: 1; padding: 12px; border: none; border-radius: 10px; background: var(--primary); color: #fff; font-size: 15px; font-weight: 700; cursor: pointer; font-family: inherit; }
.q-btn-next:active { opacity: 0.85; }
.q-btn-next.disabled { background: #E9E9EB; color: var(--text-muted); cursor: not-allowed; }

.chip-grid { display: flex; flex-wrap: wrap; gap: 8px; }
.chip { padding: 10px 16px; border: 1.5px solid var(--border); border-radius: 20px; background: #fff; color: var(--text); font-size: 14px; font-weight: 600; cursor: pointer; transition: all .2s; }
.chip.selected { border-color: var(--primary); background: #FFF4ED; color: var(--primary); }

/* ‚ïê‚ïê‚ïê DASHBOARDS ‚ïê‚ïê‚ïê */
#clientDash, #expertDash { background: var(--bg-gray); padding-top: var(--safe-top); min-height: 100vh; padding-bottom: calc(70px + var(--safe-bot)); }
.dash-header { background: #fff; border-bottom: 1px solid var(--border); padding: 14px 20px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 40; }
.avatar { width: 36px; height: 36px; border-radius: 50%; background: var(--primary); display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: 700; color: #fff; cursor: pointer; }

.tab-content { padding: 18px 20px; }

.req-card { background: #fff; border: 1px solid var(--border); border-radius: 14px; padding: 18px; margin-bottom: 12px; }
.req-top { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px; }
.req-left h4 { font-size: 16px; font-weight: 700; color: var(--text); margin-bottom: 4px; }
.req-left .meta { font-size: 12px; color: var(--text-muted); }
.status-badge { padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.3px; }
.status-badge.pending { background: #FFF4ED; color: var(--primary); }
.status-badge.active { background: #E8F5E9; color: var(--green); }
.req-desc { font-size: 14px; color: var(--text-light); line-height: 1.5; margin-bottom: 12px; }
.req-footer { display: flex; justify-content: space-between; align-items: center; padding-top: 10px; border-top: 1px solid var(--border); }

.response-card { background: #F9FAFB; border: 1px solid var(--border); border-radius: 12px; padding: 14px; margin-top: 10px; }
.resp-header { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
.resp-avatar { width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #FC8019, #E67417); display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: 700; color: #fff; }
.resp-info h5 { font-size: 14px; font-weight: 700; color: var(--text); }
.resp-info .rating { font-size: 12px; color: var(--text-muted); margin-top: 2px; }
.resp-body { font-size: 13px; color: var(--text-light); line-height: 1.5; margin-bottom: 10px; }

.empty-state { text-align: center; padding: 60px 20px; }
.empty-state .icon { font-size: 64px; margin-bottom: 16px; opacity: 0.3; }
.empty-state h3 { font-size: 18px; font-weight: 700; color: var(--text); margin-bottom: 8px; }
.empty-state p { font-size: 14px; color: var(--text-muted); }

/* ‚ïê‚ïê‚ïê EXPERT ‚ïê‚ïê‚ïê */
.credit-badge { display: flex; align-items: center; gap: 5px; padding: 6px 12px; border-radius: 18px; background: #FFF4ED; border: 1px solid var(--primary); color: var(--primary); font-size: 13px; font-weight: 700; cursor: pointer; }

.filter-bar { background: #fff; border-bottom: 1px solid var(--border); padding: 12px 20px; }
.filter-pills { display: flex; gap: 8px; overflow-x: auto; -webkit-overflow-scrolling: touch; scrollbar-width: none; }
.filter-pills::-webkit-scrollbar { display: none; }
.filter-pill { padding: 8px 16px; border: 1px solid var(--border); border-radius: 20px; background: #fff; color: var(--text-muted); font-size: 13px; font-weight: 600; white-space: nowrap; cursor: pointer; }
.filter-pill.active { border-color: var(--primary); background: #FFF4ED; color: var(--primary); }

.req-list { padding: 14px 20px; }
.browse-card { background: #fff; border: 1px solid var(--border); border-radius: 14px; padding: 16px; margin-bottom: 12px; cursor: pointer; position: relative; }
.browse-card:active { transform: scale(0.99); }
.browse-credit { position: absolute; top: 16px; right: 16px; padding: 4px 10px; border-radius: 12px; background: #FFF4ED; color: var(--primary); font-size: 11px; font-weight: 700; }
.browse-top { display: flex; align-items: flex-start; margin-bottom: 8px; padding-right: 70px; }
.browse-cat { display: flex; align-items: center; gap: 8px; }
.cat-icon { font-size: 20px; }
.browse-cat h4 { font-size: 15px; font-weight: 700; color: var(--text); }
.browse-desc { font-size: 13px; color: var(--text-light); line-height: 1.5; margin-bottom: 10px; }
.browse-footer { display: flex; justify-content: space-between; align-items: center; }

.approach-card { background: #fff; border: 1px solid var(--border); border-radius: 14px; padding: 16px; margin-bottom: 12px; }
.approach-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
.approach-header h4 { font-size: 15px; font-weight: 700; color: var(--text); }
.approach-status { padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 700; text-transform: uppercase; }
.approach-status.sent { background: #FFF4ED; color: var(--primary); }
.approach-status.unlocked { background: #E8F5E9; color: var(--green); }

.contact-info { background: #E8F5E9; border: 1px solid #C8E6C9; border-radius: 10px; padding: 12px; margin-top: 10px; }
.contact-info h5 { font-size: 13px; font-weight: 700; color: var(--text); margin-bottom: 6px; }
.contact-info p { font-size: 13px; color: var(--text-light); margin-bottom: 3px; }

/* profile */
.profile-section { background: #fff; border: 1px solid var(--border); border-radius: 14px; padding: 20px; margin-bottom: 16px; }
.profile-header { text-align: center; margin-bottom: 20px; }
.profile-avatar-lg { width: 80px; height: 80px; border-radius: 50%; background: linear-gradient(135deg, #FC8019, #E67417); display: flex; align-items: center; justify-content: center; font-size: 28px; font-weight: 800; color: #fff; margin: 0 auto 12px; }
.profile-name { font-size: 20px; font-weight: 700; color: var(--text); margin-bottom: 4px; }
.profile-specialty { font-size: 14px; color: var(--text-muted); margin-bottom: 8px; }

.section-title { font-size: 16px; font-weight: 700; color: var(--text); margin-bottom: 12px; }
.qual-item { padding: 12px; background: var(--bg-gray); border-radius: 10px; margin-bottom: 8px; }
.qual-item h5 { font-size: 14px; font-weight: 700; color: var(--text); margin-bottom: 2px; }
.qual-item p { font-size: 12px; color: var(--text-muted); }

/* ‚ïê‚ïê‚ïê BOTTOM NAV ‚ïê‚ïê‚ïê */
.bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: #fff; border-top: 1px solid var(--border); display: flex; padding-bottom: var(--safe-bot); z-index: 50; }
.nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 4px; padding: 10px 0; background: none; border: none; color: var(--text-muted); cursor: pointer; font-size: 11px; font-weight: 600; font-family: inherit; }
.nav-item svg { width: 22px; height: 22px; }
.nav-item.active { color: var(--primary); }

/* ‚ïê‚ïê‚ïê MODAL ‚ïê‚ïê‚ïê */
.modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); backdrop-filter: blur(2px); z-index: 100; display: none; align-items: flex-end; }
.modal-overlay.open { display: flex; animation: fadeIn .2s ease; }
.modal-sheet { background: #fff; border-radius: 20px 20px 0 0; width: 100%; max-height: 85vh; overflow-y: auto; padding: 0 20px calc(24px + var(--safe-bot)); animation: slideUp .25s ease; }
@keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
.modal-handle { width: 36px; height: 4px; background: var(--border); border-radius: 2px; margin: 12px auto 20px; }
.modal-title { font-size: 20px; font-weight: 700; color: var(--text); margin-bottom: 8px; }
.modal-subtitle { font-size: 14px; color: var(--text-muted); margin-bottom: 20px; }

.credit-pack { background: #fff; border: 2px solid var(--border); border-radius: 14px; padding: 20px 16px; margin-bottom: 12px; cursor: pointer; text-align: center; position: relative; }
.credit-pack.popular { border-color: var(--primary); background: #FFF4ED; }
.credit-pack .badge { position: absolute; top: -10px; left: 50%; transform: translateX(-50%); background: var(--primary); color: #fff; padding: 3px 12px; border-radius: 12px; font-size: 10px; font-weight: 700; text-transform: uppercase; }
.credit-pack .amount { font-size: 28px; font-weight: 800; color: var(--text); margin-bottom: 4px; }
.credit-pack .credits { font-size: 13px; color: var(--text-muted); margin-bottom: 10px; }
.credit-pack .price { font-size: 22px; font-weight: 700; color: var(--primary); }
.credit-pack .per-credit { font-size: 12px; color: var(--text-muted); margin-top: 2px; }
.credit-pack .savings { font-size: 11px; color: var(--green); font-weight: 600; margin-top: 4px; }

.unlock-preview { background: var(--bg-gray); border-radius: 12px; padding: 14px; margin-bottom: 16px; }
.unlock-preview h4 { font-size: 15px; font-weight: 700; color: var(--text); margin-bottom: 6px; }
.unlock-preview .detail { font-size: 13px; color: var(--text-light); margin-bottom: 3px; }

</head>
<body>

<!-- LANDING -->
<div id="landing" class="page active">
  <nav class="land-nav">
    <div class="logo">
      <div class="logo-icon">W</div>
      <div class="logo-text">WorkIndex</div>
    </div>
    <div class="land-btns">
      <button class="btn-outline" onclick="goAuth('login')">Log In</button>
      <button class="btn-primary" onclick="goAuth('signup')">Sign Up</button>
    </div>
  </nav>

  <div class="hero">
    <h1>Find the <span class="highlight">right expert</span> for your needs</h1>
    <p>From ITR filing to app development ‚Äî connect with verified professionals instantly.</p>
    <div class="hero-actions">
      <button class="hero-btn hero-btn-orange" onclick="goAuth('signup', 'client')">
        üìã I need help (Client)
      </button>
      <button class="hero-btn hero-btn-white" onclick="goAuth('signup', 'expert')">
        üíº I'm a professional (Expert)
      </button>
    </div>
  </div>

  <div class="features">
    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-bottom:32px;text-align:center;">
      <div>
        <div style="font-size:28px;font-weight:800;color:var(--primary);">500+</div>
        <div style="font-size:12px;color:var(--text-muted);">Active Experts</div>
      </div>
      <div>
        <div style="font-size:28px;font-weight:800;color:var(--primary);">1.2K+</div>
        <div style="font-size:12px;color:var(--text-muted);">Projects Done</div>
      </div>
      <div>
        <div style="font-size:28px;font-weight:800;color:var(--primary);">98%</div>
        <div style="font-size:12px;color:var(--text-muted);">Satisfaction</div>
      </div>
    </div>
    
    <h2>How it works</h2>
    <div class="feat-grid">
      <div class="feat-card"><div class="icon">üìù</div><h4>Post Your Need</h4><p>Answer questions</p></div>
      <div class="feat-card"><div class="icon">üëÄ</div><h4>Get Approaches</h4><p>Experts reach out</p></div>
      <div class="feat-card"><div class="icon">‚úÖ</div><h4>Choose Expert</h4><p>Review & select</p></div>
      <div class="feat-card"><div class="icon">ü§ù</div><h4>Get Work Done</h4><p>Connect & complete</p></div>
    </div>
  </div>
</div>

<!-- AUTH -->
<div id="auth" class="page">
  <button class="auth-back" onclick="goPage('landing')">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5"><path d="M19 12H5M12 19l-7-7 7-7"/></svg> Back
  </button>
  
  <div class="auth-wrap">
    <div class="auth-logo">
      <div class="logo-icon">W</div>
      <div class="logo-text">WorkIndex</div>
    </div>

    <div id="authForm" class="auth-card">
      <div class="auth-toggle">
        <button id="toggleLogin" class="active" onclick="switchAuth('login')">Log In</button>
        <button id="toggleSignup" onclick="switchAuth('signup')">Sign Up</button>
      </div>

      <label style="font-size:13px; font-weight:600; color:var(--text); margin-bottom:8px; display:block;">I am a</label>
      <div class="role-pick">
        <div class="role-card" id="roleClient" onclick="pickRole('client')">
          <div class="r-icon">üìã</div>
          <div class="r-label">Client</div>
        </div>
        <div class="role-card" id="roleExpert" onclick="pickRole('expert')">
          <div class="r-icon">üíº</div>
          <div class="r-label">Expert</div>
        </div>
      </div>

      <div id="nameField" class="field" style="display:none;">
        <label>Full Name</label>
        <input type="text" id="inName" placeholder="Enter your full name">
      </div>

      <div class="field">
        <label>Email Address</label>
        <input type="email" id="inEmail" placeholder="you@example.com">
      </div>

      <div class="field">
        <label>Phone Number</label>
        <div class="phone-row">
          <div class="phone-prefix">+91</div>
          <input type="tel" id="inPhone" placeholder="9876543210" maxlength="10">
        </div>
      </div>

      <div class="field">
        <label>Password</label>
        <input type="password" id="inPass" placeholder="Create a password">
      </div>

      <button class="submit-btn disabled" id="authSubmit" onclick="submitAuth()">Continue</button>

      <div class="auth-footer" id="authFooter">
        Already have an account? <a onclick="switchAuth('signup')">Sign up</a>
      </div>
    </div>

    <div id="verifyForm" class="auth-card" style="display:none;">
      <div class="verify-steps">
        <div class="v-step done" id="vStep0"></div>
        <div class="v-step" id="vStep1"></div>
      </div>
      <div class="verify-title" id="verifyTitle">Verify Email</div>
      <div class="verify-sub" id="verifySub">Enter the 6-digit code sent to your email</div>
      <input class="otp-input" id="otpInput" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" maxlength="6" inputmode="numeric">
      <div class="resend">Resend code</div>
      <button class="submit-btn" id="verifyBtn" onclick="submitVerify()">Verify & Continue</button>
    </div>
  </div>
</div>

<!-- QUESTIONNAIRE -->
<div id="questionnaire" class="page">
  <div class="q-progress">
    <div style="display:flex;justify-content:space-between;align-items:center;padding:0 20px 10px;">
      <div class="q-step-text" id="qStepText">Step 1 of 10</div>
      <button onclick="if(confirm('Exit questionnaire? Progress will be lost.')){enterDashboard()}" style="padding:6px 12px;border:1px solid var(--border);border-radius:6px;background:#fff;color:var(--text);font-size:12px;font-weight:600;cursor:pointer;">Exit</button>
    </div>
    <div class="q-progress-bar">
      <div class="q-progress-fill" id="qProgressFill" style="width:0%"></div>
    </div>
  </div>

  <div class="q-content" id="qContent"></div>

  <div class="q-nav">
    <button class="q-btn-back" id="qBackBtn" onclick="qBack()" style="display:none;">Back</button>
    <button class="q-btn-next disabled" id="qNextBtn" onclick="qNext()">Continue</button>
  </div>
</div>

<!-- CLIENT DASHBOARD -->
<div id="clientDash" class="page">
  <div class="dash-header">
    <div class="logo">
      <div class="logo-icon">W</div>
      <div class="logo-text">WorkIndex</div>
    </div>
    <div style="display:flex;align-items:center;gap:10px;">
      <button onclick="logout()" style="padding:6px 12px;border:1px solid var(--border);border-radius:6px;background:#fff;color:var(--text);font-size:12px;font-weight:600;cursor:pointer;">Logout</button>
      <div class="avatar" id="clientAvatar" onclick="clientSwitchTab('profile')">AK</div>
    </div>
  </div>

  <div id="clientTabRequests" class="tab-content"></div>

  <div id="clientTabProfile" class="tab-content" style="display:none;">
    <div class="profile-section">
      <div class="profile-header">
        <div class="profile-avatar-lg" id="clientProfAvatar">AK</div>
        <div class="profile-name" id="clientProfName">Client Name</div>
        <div class="profile-specialty" id="clientProfEmail"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="61040c00080d210419000c110d044f020e0c">[email&#160;protected]</a></div>
      </div>
      <div class="section-title">Account Details</div>
      <div class="qual-item">
        <h5>Phone</h5>
        <p id="clientProfPhone">+91 9876543210</p>
      </div>
      <div class="qual-item">
        <h5>Member Since</h5>
        <p>February 2026</p>
      </div>
      <button class="submit-btn" style="margin-top:20px;" onclick="logout()">Log Out</button>
    </div>
  </div>

  <div class="bottom-nav">
    <button class="nav-item active" id="clientNavReq" onclick="clientSwitchTab('requests')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M9 11h6M9 15h6"/></svg>
      My Requests
    </button>
    <button class="nav-item" id="clientNavPost" onclick="startQuestionnaire()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><path d="M12 8v8M8 12h8"/></svg>
      Post New
    </button>
</style>
</head>
<body>

<!-- LANDING PAGE -->
<div id="landing" class="page active">
  <nav class="land-nav">
    <div class="logo">
      <div class="logo-icon">W</div>
      <div class="logo-text">WorkIndex</div>
    </div>
    <div class="land-btns">
      <button class="btn-outline" onclick="goAuth('login')">Log in</button>
      <button class="btn-primary" onclick="goAuth('signup')">Sign up</button>
    </div>
  </nav>

  <section class="hero">
    <div class="hero-badge">
      <div class="dot"></div>
      <span>Now Live in India</span>
    </div>
    <h1>Connect with <span class="highlight">Verified Experts</span> for Every Need</h1>
    <p>From tax filing to web development, find professionals who deliver quality work on time.</p>
    
    <div class="hero-actions">
      <button class="hero-btn hero-btn-orange" onclick="goAuth('signup', 'client')">
        <span>üéØ</span> I need a service
      </button>
      <button class="hero-btn hero-btn-white" onclick="goAuth('signup', 'expert')">
        <span>üíº</span> I'm an expert
      </button>
    </div>
  </section>

  <section class="features">
    <h2>Why Choose WorkIndex?</h2>
    <div class="feat-grid">
      <div class="feat-card">
        <div class="icon">‚úÖ</div>
        <h4>Verified Experts</h4>
        <p>All professionals are background-checked</p>
      </div>
      <div class="feat-card">
        <div class="icon">üí∞</div>
        <h4>Fair Pricing</h4>
        <p>Transparent quotes, no hidden fees</p>
      </div>
      <div class="feat-card">
        <div class="icon">‚ö°</div>
        <h4>Quick Turnaround</h4>
        <p>Get matched with experts in minutes</p>
      </div>
      <div class="feat-card">
        <div class="icon">üîí</div>
        <h4>Secure Payments</h4>
        <p>Pay only when satisfied</p>
      </div>
    </div>
  </section>
</div>

<!-- AUTH PAGE -->
<div id="auth" class="page">
  <button class="auth-back" onclick="goPage('landing')">‚Üê Back</button>
  
  <div class="auth-wrap">
    <div class="auth-logo">
      <div class="logo-icon">W</div>
      <div class="logo-text">WorkIndex</div>
    </div>

    <div class="auth-card">
      <div class="auth-toggle">
        <button id="toggleLogin" class="active" onclick="switchAuth('login')">Log in</button>
        <button id="toggleSignup" onclick="switchAuth('signup')">Sign up</button>
      </div>

      <div class="role-pick">
        <div class="role-card" id="roleClient" onclick="pickRole('client')">
          <div class="r-icon">üéØ</div>
          <div class="r-label">Client</div>
        </div>
        <div class="role-card" id="roleExpert" onclick="pickRole('expert')">
          <div class="r-icon">üíº</div>
          <div class="r-label">Expert</div>
        </div>
      </div>

      <div id="authForm">
        <div class="field" id="nameField" style="display:none;">
          <label>Full Name</label>
          <input type="text" id="inName" placeholder="Enter your name">
        </div>

        <div class="field">
          <label>Email</label>
          <input type="email" id="inEmail" placeholder="you@example.com">
        </div>

        <div class="field">
          <label>Phone Number</label>
          <div class="phone-row">
            <div class="phone-prefix">+91</div>
            <input type="tel" id="inPhone" placeholder="9876543210" maxlength="10">
          </div>
        </div>

        <div class="field">
          <label>Password</label>
          <input type="password" id="inPass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
        </div>

        <button class="submit-btn disabled" id="authSubmit" onclick="submitAuth()">Log In</button>
      </div>

      <div id="verifyForm" style="display:none;">
        <div class="verify-steps">
          <div class="v-step done" id="vStep0"></div>
          <div class="v-step" id="vStep1"></div>
        </div>
        <div class="verify-title" id="verifyTitle">Verify Email</div>
        <div class="verify-sub" id="verifySub">Code sent to your email</div>
        <input type="text" class="otp-input" id="otpInput" placeholder="000000" maxlength="6">
        <div class="resend" onclick="alert('OTP resent!')">Resend Code</div>
        <button class="submit-btn" onclick="submitVerify()">Verify</button>
      </div>

      <div class="auth-footer" id="authFooter">
        No account? <a onclick="switchAuth('signup')">Sign up</a>
      </div>
    </div>
  </div>
</div>

<!-- QUESTIONNAIRE PAGE -->
<div id="questionnaire" class="page">
  <div class="q-progress">
    <div class="q-progress-bar">
      <div class="q-progress-fill" id="qProgressFill" style="width:0%"></div>
    </div>
    <div class="q-step-text" id="qStepText">Step 1 of 5</div>
  </div>

  <div class="q-content" id="qContent">
    <!-- Dynamic content -->
  </div>

  <div class="q-nav">
    <button class="q-btn-back" id="qBackBtn" onclick="qBack()" style="display:none;">‚Üê Back</button>
    <button class="q-btn-next disabled" id="qNextBtn" onclick="qNext()">Next ‚Üí</button>
  </div>
</div>

<!-- CLIENT DASHBOARD -->
<div id="clientDash" class="page">
  <div class="dash-header">
    <div class="logo">
      <div class="logo-icon">W</div>
      <div class="logo-text">WorkIndex</div>
    </div>
    <div class="avatar" id="clientAvatar" onclick="clientSwitchTab('profile')">U</div>
  </div>

  <div id="clientTabReq" class="tab-content" style="display:none;">
    <div style="padding:20px;">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
        <h2 style="font-size:20px;font-weight:700;">My Requests</h2>
        <button onclick="startQuestionnaire()" style="padding:8px 16px;border:none;border-radius:8px;background:var(--primary);color:#fff;font-size:14px;font-weight:600;cursor:pointer;">+ New Request</button>
      </div>
      <div id="clientReqList"></div>
    </div>
  </div>

  <div id="clientTabProfile" class="tab-content" style="display:none;">
    <div class="profile-section">
      <div class="profile-header">
        <div class="profile-avatar-lg" id="clientProfAvatar">U</div>
        <div class="profile-name" id="clientProfName" style="margin-top:12px;">User Name</div>
      </div>

      <div class="section-title" style="margin-top:20px;">Contact</div>
      <div class="qual-item">
        <h5>Email</h5>
        <p id="clientProfEmail">user@example.com</p>
      </div>
      <div class="qual-item">
        <h5>Phone</h5>
        <p id="clientProfPhone">+91 9876543210</p>
      </div>

      <button class="submit-btn" style="margin-top:20px;" onclick="logout()">Log Out</button>
    </div>
  </div>

  <div class="bottom-nav">
    <button class="nav-item active" id="clientNavReq" onclick="clientSwitchTab('requests')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M9 5H7a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-2"/><rect x="9" y="3" width="6" height="4" rx="1"/></svg>
      Requests
    </button>
    <button class="nav-item" id="clientNavProf" onclick="clientSwitchTab('profile')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="8" r="4"/></svg>
      Profile
    </button>
  </div>
</div>

<!-- EXPERT DASHBOARD -->
<div id="expertDash" class="page">
  <div class="dash-header">
    <div class="logo">
      <div class="logo-icon">W</div>
      <div class="logo-text">WorkIndex</div>
    </div>
    <div style="display:flex; align-items:center; gap:10px;">
      <button onclick="logout()" style="padding:6px 12px;border:1px solid var(--border);border-radius:6px;background:#fff;color:var(--text);font-size:12px;font-weight:600;cursor:pointer;">Logout</button>
      <div class="credit-badge" id="expertCreditBadge" onclick="openBuyCredits()">üíé <span id="expertCredits">50</span></div>
      <div class="avatar" id="expertAvatar" onclick="expertSwitchTab('profile')">PS</div>
    </div>
  </div>

  <div id="expertTabBrowse" style="display:none;">
    <div class="filter-bar">
      <div class="filter-pills" id="expertFilterPills"></div>
    </div>
    <div class="req-list" id="expertBrowseList"></div>
  </div>

  <div id="expertTabApproaches" class="tab-content" style="display:none;"></div>

  <div id="expertTabProfile" class="tab-content" style="display:none;">
    <div class="profile-section">
      <div class="profile-header">
        <div class="profile-avatar-lg" id="expertProfAvatar">PS</div>
        <button onclick="openEditProfile()" style="margin-top:12px;padding:8px 16px;border:1px solid var(--primary);border-radius:8px;background:#fff;color:var(--primary);font-size:13px;font-weight:600;cursor:pointer;">Edit Profile</button>
        <div class="profile-name" id="expertProfName" style="margin-top:12px;">Expert Name</div>
        <div class="profile-specialty" id="expertProfSpec" style="color:var(--text-muted);font-size:14px;">Specialization</div>
      </div>

      <div id="expertProfileContent"></div>

      <button class="submit-btn" style="margin-top:20px;" onclick="logout()">Log Out</button>
    </div>
  </div>

  <div class="bottom-nav">
    <button class="nav-item active" id="expertNavBrowse" onclick="expertSwitchTab('browse')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
      Browse
    </button>
    <button class="nav-item" id="expertNavApp" onclick="expertSwitchTab('approaches')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
      Approaches
    </button>
    <button class="nav-item" id="expertNavProf" onclick="expertSwitchTab('profile')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="8" r="4"/></svg>
      Profile
    </button>
  </div>
</div>

<!-- MODAL -->
<div class="modal-overlay" id="modal" onclick="closeModal()">
  <div class="modal-sheet" onclick="event.stopPropagation()">
    <div class="modal-handle"></div>
    <div id="modalContent"></div>
  </div>
</div>


<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CONFIGURATION & STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const API_URL = 'https://workindex-production.up.railway.app/api';

const CREDIT_PACKS = [
  { credits: 20, price: 600, savings: 0 },
  { credits: 50, price: 1500, savings: 0 },
  { credits: 100, price: 2700, savings: 10, popular: true },
  { credits: 200, price: 4800, savings: 20 }
];

let state = {
  role: null,
  user: null,
  userId: null,
  token: null,
  authMode: 'login',
  verifyStep: 0,
  qStep: 0,
  qAnswers: {},
  qSequence: null,
  clientRequests: [],
  expertApproaches: [],
  expertCredits: 50,
  unlockedRequests: [],
  approachedRequests: []
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DATA.JS - Questionnaire Forms & Data Structures
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// Credit Calculation Function
function calculateCredits(service, answers) {
  const base = { 
    itr: 15, 
    gst: 20, 
    accounting: 25, 
    audit: 30, 
    photography: 18, 
    development: 35 
  };
  
  let credits = base[service] || 20;
  
  if (service === 'itr') {
    if (answers.incomeBracket === '25+') credits = 25;
    if (answers.incomeSource && answers.incomeSource.includes('business')) credits = 30;
  }
  
  if (service === 'gst' && answers.turnover === '20cr+') credits = 30;
  if (service === 'accounting' && answers.employees && parseInt(answers.employees) > 50) credits = 35;
  
  return credits;
}

// Questionnaire Forms
const Q_FORMS = {
  // CLIENT FORMS
  service: {
    title: "What service do you need?",
    subtitle: "Select the category",
    type: "single",
    key: "service",
    options: [
      { value: "itr", icon: "üìÑ", label: "ITR Filing", desc: "Income Tax Return" },
      { value: "gst", icon: "üè¢", label: "GST Services", desc: "Registration, filing" },
      { value: "accounting", icon: "üìä", label: "Accounting", desc: "Bookkeeping" },
      { value: "audit", icon: "üîç", label: "Audit Services", desc: "Statutory audit" },
      { value: "photography", icon: "üì∏", label: "Photography", desc: "Events, product" },
      { value: "development", icon: "üíª", label: "App/Web Dev", desc: "Build digital products" }
    ]
  },
  
  // ITR Forms
  itr_for: { 
    condition: { service: "itr" }, 
    title: "Who is the return for?", 
    type: "single", 
    key: "itrFor", 
    options: [
      { value: "individual", label: "Individual" }, 
      { value: "freelancer", label: "Freelancer" }, 
      { value: "business", label: "Business" }
    ] 
  },
  
  itr_income_source: { 
    condition: { service: "itr" }, 
    title: "Sources of income?", 
    subtitle: "Select all", 
    type: "multi", 
    key: "incomeSource", 
    options: [
      { value: "salary", label: "Salary" }, 
      { value: "business", label: "Business" }, 
      { value: "rental", label: "Rental" }, 
      { value: "capital", label: "Capital Gains" }, 
      { value: "other", label: "Other" }
    ] 
  },
  
  itr_income_bracket: { 
    condition: { service: "itr" }, 
    title: "Annual income?", 
    type: "single", 
    key: "incomeBracket", 
    options: [
      { value: "below5", label: "Below ‚Çπ5L" }, 
      { value: "5-10", label: "‚Çπ5-10L" }, 
      { value: "10-15", label: "‚Çπ10-15L" }, 
      { value: "15-20", label: "‚Çπ15-20L" }, 
      { value: "20-25", label: "‚Çπ20-25L" }, 
      { value: "25+", label: ">‚Çπ25L" }
    ] 
  },
  
  // GST Forms
  gst_service: { 
    condition: { service: "gst" }, 
    title: "What GST service?", 
    type: "single", 
    key: "gstService", 
    options: [
      { value: "registration", label: "New Registration" }, 
      { value: "monthly", label: "Monthly Filing" }, 
      { value: "annual", label: "Annual Return" }
    ] 
  },
  
  gst_turnover: { 
    condition: { service: "gst" }, 
    title: "Annual turnover?", 
    type: "single", 
    key: "turnover", 
    options: [
      { value: "below20", label: "< ‚Çπ20L" }, 
      { value: "20-1cr", label: "‚Çπ20L-1Cr" }, 
      { value: "1-5cr", label: "‚Çπ1-5Cr" }, 
      { value: "20cr+", label: "‚Çπ20Cr+" }
    ] 
  },
  
  // Common Client Forms
  timeline: { 
    title: "When do you need this?", 
    type: "single", 
    key: "timeline", 
    options: [
      { value: "immediate", icon: "üî¥", label: "Immediate" }, 
      { value: "week", icon: "üü†", label: "Within week" }, 
      { value: "month", icon: "üü°", label: "Within month" }, 
      { value: "flexible", icon: "üü¢", label: "Flexible" }
    ] 
  },
  
  budget: { 
    title: "Budget range?", 
    subtitle: "Select amount", 
    type: "single", 
    key: "budget", 
    options: [
      { value: "500", label: "‚Çπ500" }, 
      { value: "1000", label: "‚Çπ1,000" }, 
      { value: "1500", label: "‚Çπ1,500" }, 
      { value: "2000", label: "‚Çπ2,000" }, 
      { value: "2500", label: "‚Çπ2,500" }, 
      { value: "3000", label: "‚Çπ3,000" },
      { value: "3500", label: "‚Çπ3,500" }, 
      { value: "4000", label: "‚Çπ4,000" }, 
      { value: "4500", label: "‚Çπ4,500" },
      { value: "5000", label: "‚Çπ5,000" }, 
      { value: "6000", label: "‚Çπ6,000" }, 
      { value: "7000", label: "‚Çπ7,000" },
      { value: "8000", label: "‚Çπ8,000" }, 
      { value: "9000", label: "‚Çπ9,000" }, 
      { value: "10000", label: "‚Çπ10,000" },
      { value: "12000", label: "‚Çπ12,000" }, 
      { value: "15000", label: "‚Çπ15,000" }, 
      { value: "20000", label: "‚Çπ20,000" }
    ] 
  },
  
  details: { 
    title: "Additional details", 
    type: "textarea", 
    key: "details", 
    placeholder: "Describe your requirement..." 
  },
  
  location: { 
    title: "Your location", 
    type: "input", 
    key: "location", 
    inputType: "text", 
    placeholder: "City, State" 
  },
  
  // EXPERT QUESTIONNAIRE FORMS
  expert_services: {
    title: "What services do you provide?",
    subtitle: "Select all that apply",
    type: "multi",
    key: "expertServices",
    options: [
      { value: "ITR Filing", label: "Income Tax Return (ITR) Filing" },
      { value: "GST Services", label: "GST Registration & Filing" },
      { value: "Accounting", label: "Accounting & Bookkeeping" },
      { value: "Tax Planning", label: "Tax Planning & Consulting" },
      { value: "Company Registration", label: "Company Registration" },
      { value: "Audit", label: "Audit Services" },
      { value: "Payroll", label: "Payroll Management" },
      { value: "Financial Consulting", label: "Financial Consulting" },
      { value: "Legal Services", label: "Legal Services" },
      { value: "Other", label: "Other Professional Services" }
    ]
  },
  
  expert_company_name: {
    title: "What is your company name?",
    subtitle: "Enter your business or firm name",
    type: "input",
    key: "companyName",
    inputType: "text",
    placeholder: "e.g., ABC Tax Consultants Pvt Ltd"
  },
  
  expert_has_website: {
    title: "Do you have a website?",
    subtitle: "This helps us understand your digital presence",
    type: "single",
    key: "hasWebsite",
    options: [
      { value: "yes", icon: "üåê", label: "Yes, I have a website" },
      { value: "no", icon: "üì±", label: "No, I don't have a website" },
      { value: "planning", icon: "üöÄ", label: "Planning to create one soon" }
    ]
  },
  
  expert_website_url: {
    title: "Enter your website URL",
    subtitle: "We'll verify your digital presence",
    type: "input",
    key: "websiteUrl",
    inputType: "url",
    placeholder: "https://www.yourwebsite.com",
    condition: { hasWebsite: "yes" }
  },
  
  expert_company_size: {
    title: "What is your company size?",
    subtitle: "Number of team members including you",
    type: "single",
    key: "companySize",
    options: [
      { value: "solo", icon: "üë§", label: "Solo Professional (Just Me)", desc: "1 person" },
      { value: "small", icon: "üë•", label: "Small Team", desc: "2-5 people" },
      { value: "medium", icon: "üë®‚Äçüë©‚Äçüëß‚Äçüë¶", label: "Medium Team", desc: "6-20 people" },
      { value: "large", icon: "üè¢", label: "Large Organization", desc: "20+ people" }
    ]
  },
  
  expert_experience: {
    title: "How many years of experience do you have?",
    subtitle: "Your total professional experience",
    type: "single",
    key: "experience",
    options: [
      { value: "less1", icon: "üå±", label: "Less than 1 year" },
      { value: "1-3", icon: "üåø", label: "1-3 years" },
      { value: "3-5", icon: "üå≥", label: "3-5 years" },
      { value: "5-10", icon: "üéØ", label: "5-10 years" },
      { value: "10+", icon: "üèÜ", label: "10+ years" }
    ]
  },
  
  expert_certifications: {
    title: "Do you have any certifications?",
    subtitle: "Professional qualifications (select all that apply)",
    type: "multi",
    key: "certifications",
    options: [
      { value: "CA", label: "Chartered Accountant (CA)" },
      { value: "CS", label: "Company Secretary (CS)" },
      { value: "CMA", label: "Cost and Management Accountant (CMA)" },
      { value: "CPA", label: "Certified Public Accountant (CPA)" },
      { value: "MBA", label: "MBA - Finance" },
      { value: "Tax Practitioner", label: "Tax Practitioner" },
      { value: "Legal", label: "Legal Practitioner" },
      { value: "Other", label: "Other Professional Certification" },
      { value: "None", label: "No formal certification" }
    ]
  }
};

// Build Question Sequence
function buildQuestionSequence() {
  const service = state.qAnswers.service;
  let seq = [];
  
  // Expert questionnaire
  if (state.role === 'expert') {
    seq = [
      'expert_services', 
      'expert_company_name', 
      'expert_has_website', 
      'expert_website_url', 
      'expert_company_size', 
      'expert_experience', 
      'expert_certifications'
    ];
    return seq;
  }
  
  // Client questionnaire
  seq = ['service'];
  if (service === 'itr') seq.push('itr_for', 'itr_income_source', 'itr_income_bracket');
  else if (service === 'gst') seq.push('gst_service', 'gst_turnover');
  
  seq.push('timeline', 'budget', 'details', 'location');
  return seq;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MAIN APPLICATION LOGIC - FIXED VERSION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function goPage(id) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  window.scrollTo(0, 0);
}

function goAuth(mode, role) {
  state.authMode = mode;
  if (role) state.role = role;
  switchAuth(mode);
  if (role) pickRole(role);
  goPage('auth');
}

function switchAuth(mode) {
  state.authMode = mode;
  document.getElementById('toggleLogin').classList.toggle('active', mode === 'login');
  document.getElementById('toggleSignup').classList.toggle('active', mode === 'signup');
  document.getElementById('nameField').style.display = mode === 'signup' ? 'block' : 'none';
  document.getElementById('authSubmit').textContent = mode === 'signup' ? 'Create Account' : 'Log In';
  document.getElementById('authFooter').innerHTML = mode === 'signup' ? 'Already have an account? <a onclick="switchAuth(\'login\')">Log in</a>' : 'No account? <a onclick="switchAuth(\'signup\')">Sign up</a>';
  document.getElementById('authForm').style.display = 'block';
  document.getElementById('verifyForm').style.display = 'none';
}

function pickRole(r) {
  state.role = r;
  document.getElementById('roleClient').classList.toggle('active', r === 'client');
  document.getElementById('roleExpert').classList.toggle('active', r === 'expert');
  document.getElementById('authSubmit').classList.remove('disabled');
}

async function submitAuth() {
  if (!state.role) {
    alert('Please select your role');
    return;
  }
  
  const name = document.getElementById('inName').value.trim();
  const email = document.getElementById('inEmail').value.trim();
  const phone = document.getElementById('inPhone').value.trim();
  const password = document.getElementById('inPass').value;
  
  if (!email || !phone || !password) {
    alert('Please fill in all fields');
    return;
  }
  
  if (state.authMode === 'signup' && !name) {
    alert('Please enter your name');
    return;
  }
  
  if (phone.length !== 10) {
    alert('Phone must be 10 digits');
    return;
  }
  
  try {
    if (state.authMode === 'signup') {
      const res = await fetch(`${API_URL}/auth/register`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name, email, phone, password, role: state.role })
      });
      
      const data = await res.json();
      if (!res.ok) throw new Error(data.message || 'Registration failed');
      
      // FIXED: Use real token from backend
      state.userId = data.userId;
      state.token = data.token; // Use real token from backend
      state.user = data.user || { name, email, phone, role: state.role, credits: 50 };
      state.expertCredits = state.user.credits || 50;
      
      localStorage.setItem('token', state.token);
      localStorage.setItem('user', JSON.stringify(state.user));
      
      alert('‚úÖ Account created successfully!');
      startQuestionnaire();
    } else {
      const res = await fetch(`${API_URL}/auth/login`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, password })
      });
      
      const data = await res.json();
      if (!res.ok) throw new Error(data.message || 'Login failed');
      
      state.token = data.token;
      state.user = data.user;
      state.role = data.user.role;
      state.expertCredits = data.user.credits || 50;
      localStorage.setItem('token', data.token);
      localStorage.setItem('user', JSON.stringify(data.user));
      
      enterDashboard();
    }
  } catch (error) {
    alert(error.message);
  }
}

function startVerify() {
  state.verifyStep = 0;
  document.getElementById('authForm').style.display = 'none';
  document.getElementById('verifyForm').style.display = 'block';
  updateVerifyUI();
}

function updateVerifyUI() {
  const step = state.verifyStep;
  document.getElementById('vStep0').classList.toggle('done', true);
  document.getElementById('vStep1').classList.toggle('done', step > 0);
  document.getElementById('verifyTitle').textContent = step === 0 ? 'Verify Email' : 'Verify Phone';
  document.getElementById('verifySub').textContent = step === 0 ? `Code sent to ${state.user.email}` : `Code sent to +91 ${state.user.phone}`;
  document.getElementById('otpInput').value = '';
}

async function submitVerify() {
  const otp = document.getElementById('otpInput').value.trim();
  
  if (otp.length !== 6) {
    alert('Please enter 6-digit code');
    return;
  }
  
  try {
    if (state.verifyStep === 0) {
      const res = await fetch(`${API_URL}/auth/verify-email`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ userId: state.userId, otp })
      });
      
      const data = await res.json();
      if (!res.ok) throw new Error(data.message || 'Verification failed');
      
      await fetch(`${API_URL}/auth/send-phone-otp`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ userId: state.userId })
      });
      
      state.verifyStep = 1;
      updateVerifyUI();
      alert('Email verified! Check Railway logs for phone OTP code.');
    } else {
      const res = await fetch(`${API_URL}/auth/verify-phone`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ userId: state.userId, otp })
      });
      
      const data = await res.json();
      if (!res.ok) throw new Error(data.message || 'Verification failed');
      
      state.token = data.token;
      state.user = data.user;
      state.role = data.user.role;
      state.expertCredits = data.user.credits || 50;
      localStorage.setItem('token', data.token);
      localStorage.setItem('user', JSON.stringify(data.user));
      
      startQuestionnaire();
    }
  } catch (error) {
    alert(error.message);
  }
}

function startQuestionnaire() {
  state.qStep = 0;
  state.qAnswers = {};
  state.qSequence = null;
  renderQStep();
  goPage('questionnaire');
}

function renderQStep() {
  if (!state.qSequence) {
    if (state.role === 'expert') {
      state.qSequence = buildQuestionSequence();
    } else {
      state.qSequence = state.qStep === 0 ? ['service'] : buildQuestionSequence();
    }
  }
  
  const stepKey = state.qSequence[state.qStep];
  const step = Q_FORMS[stepKey];
  
  if (!step) { completeQuestionnaire(); return; }
  
  if (step.condition) {
    const [key, val] = Object.entries(step.condition)[0];
    if (state.qAnswers[key] !== val) { state.qStep++; renderQStep(); return; }
  }
  
  const progress = ((state.qStep + 1) / state.qSequence.length) * 100;
  document.getElementById('qProgressFill').style.width = progress + '%';
  document.getElementById('qStepText').textContent = `Step ${state.qStep + 1} of ${state.qSequence.length}`;
  document.getElementById('qBackBtn').style.display = state.qStep > 0 ? 'block' : 'none';
  
  const content = document.getElementById('qContent');
  content.innerHTML = `<div class="q-title">${step.title}</div>${step.subtitle ? `<div class="q-subtitle">${step.subtitle}</div>` : ''}`;
  
  if (step.type === 'single') {
    content.innerHTML += `<div class="q-options">${step.options.map(opt => `<div class="q-option ${state.qAnswers[step.key] === opt.value ? 'selected' : ''}" onclick="selectOption('${step.key}', '${opt.value}')">${opt.icon ? `<div class="opt-icon">${opt.icon}</div>` : ''}<div class="opt-text"><div class="opt-label">${opt.label}</div>${opt.desc ? `<div class="opt-desc">${opt.desc}</div>` : ''}</div></div>`).join('')}</div>`;
  } else if (step.type === 'multi') {
    content.innerHTML += `<div class="chip-grid">${step.options.map(opt => `<div class="chip ${state.qAnswers[step.key] && state.qAnswers[step.key].includes(opt.value) ? 'selected' : ''}" onclick="toggleChip(this, '${step.key}', '${opt.value}')">${opt.label}</div>`).join('')}</div>`;
  } else if (step.type === 'input' || step.type === 'textarea') {
    const tag = step.type === 'textarea' ? 'textarea' : 'input';
    const attrs = step.type === 'textarea' ? 'rows="4"' : `type="${step.inputType || 'text'}"`;
    content.innerHTML += `<div class="field"><${tag} id="qInput" ${attrs} placeholder="${step.placeholder}" oninput="qInputChange()">${state.qAnswers[step.key] || ''}</${tag}></div>`;
  }
  
  document.getElementById('qNextBtn').classList.toggle('disabled', !state.qAnswers[step.key]);
}

function selectOption(key, value) {
  state.qAnswers[key] = value;
  document.querySelectorAll('.q-option').forEach(opt => opt.classList.remove('selected'));
  event.currentTarget.classList.add('selected');
  document.getElementById('qNextBtn').classList.remove('disabled');
  if (key === 'service' && state.role === 'client') state.qSequence = buildQuestionSequence();
}

function toggleChip(el, key, value) {
  el.classList.toggle('selected');
  if (!state.qAnswers[key]) state.qAnswers[key] = [];
  const idx = state.qAnswers[key].indexOf(value);
  if (idx > -1) state.qAnswers[key].splice(idx, 1); else state.qAnswers[key].push(value);
  document.getElementById('qNextBtn').classList.toggle('disabled', state.qAnswers[key].length === 0);
}

function qInputChange() {
  const val = document.getElementById('qInput').value.trim();
  const step = Q_FORMS[state.qSequence[state.qStep]];
  state.qAnswers[step.key] = val;
  document.getElementById('qNextBtn').classList.toggle('disabled', !val);
}

function qNext() {
  if (document.getElementById('qNextBtn').classList.contains('disabled')) return;
  state.qStep++;
  if (state.qStep >= state.qSequence.length) completeQuestionnaire(); else renderQStep();
}

function qBack() { if (state.qStep > 0) { state.qStep--; renderQStep(); } }

async function completeQuestionnaire() {
  if (state.role === 'expert') {
    const experienceLabel = Q_FORMS.expert_experience.options.find(o => o.value === state.qAnswers.experience)?.label || state.qAnswers.experience;
    const companySizeLabel = Q_FORMS.expert_company_size.options.find(o => o.value === state.qAnswers.companySize)?.label || state.qAnswers.companySize;
    
    state.user.profile = {
      services: state.qAnswers.expertServices || [],
      companyName: state.qAnswers.companyName || '',
      hasWebsite: state.qAnswers.hasWebsite || '',
      websiteUrl: state.qAnswers.websiteUrl || '',
      companySize: companySizeLabel,
      experience: experienceLabel,
      certifications: state.qAnswers.certifications || [],
      bio: `Professional with ${experienceLabel} providing ${(state.qAnswers.expertServices || []).slice(0, 3).join(', ')}`,
      specialization: (state.qAnswers.expertServices || [])[0] || 'Professional Services'
    };
    
    localStorage.setItem('user', JSON.stringify(state.user));
    
    try {
      await fetch(`${API_URL}/users/profile`, {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${state.token}`
        },
        body: JSON.stringify({ profile: state.user.profile })
      });
    } catch (error) {
      console.error('Profile save error:', error);
    }
    
    alert('‚úÖ Profile setup complete!');
    
    // FIXED: Load data before entering dashboard
    await loadExpertRequests();
    await loadExpertApproaches();
    enterDashboard();
    return;
  }
  
  const service = Q_FORMS.service.options.find(o => o.value === state.qAnswers.service);
  const credits = calculateCredits(state.qAnswers.service, state.qAnswers);
  
  const title = service.label + ' - ' + (state.qAnswers.location || 'India');
  const description = state.qAnswers.details || 'Details in questionnaire';
  
  try {
    const res = await fetch(`${API_URL}/requests`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${state.token}`
      },
      body: JSON.stringify({
        service: state.qAnswers.service,
        title,
        description,
        answers: state.qAnswers,
        timeline: state.qAnswers.timeline || 'flexible',
        budget: state.qAnswers.budget || 'Budget TBD',
        location: state.qAnswers.location || 'India'
      })
    });
    
    const data = await res.json();
    if (!res.ok) throw new Error(data.message || 'Failed to create request');
    
    alert('‚úÖ Request posted successfully!');
    
    // FIXED: Load data before entering dashboard
    await loadClientRequests();
    enterDashboard();
  } catch (error) {
    alert(error.message);
    enterDashboard();
  }
}

async function enterDashboard() {
  if (state.role === 'client') {
    await loadClientRequests();
    goPage('clientDash');
    clientSwitchTab('requests');
  } else {
    await loadExpertRequests();
    await loadExpertApproaches();
    goPage('expertDash');
    expertSwitchTab('browse');
  }
}

function clientSwitchTab(tab) {
  document.querySelectorAll('#clientDash .tab-content').forEach(t => t.style.display = 'none');
  document.querySelectorAll('#clientDash .nav-item').forEach(n => n.classList.remove('active'));
  
  if (tab === 'requests') {
    document.getElementById('clientTabReq').style.display = 'block';
    document.getElementById('clientNavReq').classList.add('active');
    renderClientRequests();
  } else if (tab === 'profile') {
    document.getElementById('clientTabProfile').style.display = 'block';
    document.getElementById('clientNavProf').classList.add('active');
    renderClientProfile();
  }
}

function expertSwitchTab(tab) {
  document.querySelectorAll('#expertDash .tab-content, #expertDash > div:not(.dash-header):not(.bottom-nav)').forEach(t => t.style.display = 'none');
  document.querySelectorAll('#expertDash .nav-item').forEach(n => n.classList.remove('active'));
  
  if (tab === 'browse') {
    document.getElementById('expertTabBrowse').style.display = 'block';
    document.getElementById('expertNavBrowse').classList.add('active');
    renderExpertBrowse();
  } else if (tab === 'approaches') {
    document.getElementById('expertTabApproaches').style.display = 'block';
    document.getElementById('expertNavApp').classList.add('active');
    renderExpertApproaches();
  } else if (tab === 'profile') {
    document.getElementById('expertTabProfile').style.display = 'block';
    document.getElementById('expertNavProf').classList.add('active');
    renderExpertProfile();
  }
}

async function loadClientRequests() {
  if (!state.token) return;
  try {
    const res = await fetch(`${API_URL}/requests`, {
      headers: { 'Authorization': `Bearer ${state.token}` }
    });
    const data = await res.json();
    if (res.ok && data.requests) {
      state.clientRequests = data.requests.map(req => ({
        id: req._id,
        title: req.title,
        service: req.service,
        desc: req.description,
        timeline: req.timeline,
        status: req.status,
        location: req.location,
        budget: req.budget,
        posted: new Date(req.createdAt).toLocaleDateString(),
        responses: [],
        credits: req.credits,
        answers: req.answers
      }));
    }
  } catch (error) {
    console.error('Load error:', error);
  }
}

async function loadExpertRequests() {
  if (!state.token) return;
  try {
    const res = await fetch(`${API_URL}/requests/available`, {
      headers: { 'Authorization': `Bearer ${state.token}` }
    });
    const data = await res.json();
    if (res.ok && data.requests) {
      state.clientRequests = data.requests.map(req => ({
        id: req._id,
        title: req.title,
        service: req.service,
        desc: req.description,
        timeline: req.timeline,
        location: req.location,
        budget: req.budget,
        credits: req.credits,
        answers: req.answers
      }));
    }
  } catch (error) {
    console.error('Load error:', error);
  }
}

// FIXED: Load expert approaches
async function loadExpertApproaches() {
  if (!state.token) return;
  try {
    const res = await fetch(`${API_URL}/approaches/my-approaches`, {
      headers: { 'Authorization': `Bearer ${state.token}` }
    });
    const data = await res.json();
    if (res.ok && data.approaches) {
      state.expertApproaches = data.approaches.map(app => ({
        id: app._id,
        requestId: app.requestId,
        requestTitle: app.requestTitle || 'Request',
        message: app.message,
        status: app.status,
        createdAt: new Date(app.createdAt).toLocaleDateString()
      }));
      
      // FIXED: Track approached requests
      state.approachedRequests = state.expertApproaches.map(a => a.requestId);
    }
  } catch (error) {
    console.error('Load approaches error:', error);
  }
}

function renderClientRequests() {
  const list = document.getElementById('clientReqList');
  if (!state.clientRequests || state.clientRequests.length === 0) {
    list.innerHTML = '<p style="text-align:center;color:var(--text-muted);padding:40px 20px;">No requests yet. Create your first request!</p>';
    return;
  }
  
  list.innerHTML = state.clientRequests.map(req => `
    <div style="background:#fff;border:1px solid var(--border);border-radius:12px;padding:16px;margin-bottom:12px;">
      <h4 style="font-size:16px;font-weight:700;margin-bottom:4px;">${req.title}</h4>
      <p style="font-size:13px;color:var(--text-muted);">${req.desc}</p>
      <div style="display:flex;gap:8px;margin-top:10px;flex-wrap:wrap;">
        <span style="font-size:12px;color:var(--text-light);">üìç ${req.location}</span>
        <span style="font-size:12px;color:var(--text-light);">üí∞ ${req.budget}</span>
        <span style="font-size:12px;color:var(--text-light);">‚è∞ ${req.timeline}</span>
      </div>
    </div>
  `).join('');
}

function renderClientProfile() {
  document.getElementById('clientProfName').textContent = state.user.name;
  document.getElementById('clientProfEmail').textContent = state.user.email;
  document.getElementById('clientProfPhone').textContent = '+91 ' + state.user.phone;
  document.getElementById('clientProfAvatar').textContent = state.user.name.charAt(0).toUpperCase();
  document.getElementById('clientAvatar').textContent = state.user.name.charAt(0).toUpperCase();
}

function renderExpertBrowse() {
  const list = document.getElementById('expertBrowseList');
  if (!state.clientRequests || state.clientRequests.length === 0) {
    list.innerHTML = '<p style="text-align:center;color:var(--text-muted);padding:40px 20px;">No requests available</p>';
    return;
  }
  
  list.innerHTML = state.clientRequests.map(req => {
    // FIXED: Check if already approached
    const hasApproached = state.approachedRequests.includes(req.id);
    
    return `
    <div style="background:#fff;border:1px solid var(--border);border-radius:12px;padding:16px;margin:12px 20px;">
      <h4 style="font-size:16px;font-weight:700;margin-bottom:4px;">${req.title}</h4>
      <p style="font-size:13px;color:var(--text-muted);margin-bottom:10px;">${req.desc}</p>
      <div style="display:flex;gap:8px;margin-bottom:10px;flex-wrap:wrap;">
        <span style="font-size:12px;color:var(--text-light);">üìç ${req.location}</span>
        <span style="font-size:12px;color:var(--text-light);">üí∞ ${req.budget}</span>
        <span style="font-size:12px;color:var(--primary);font-weight:600;">üíé ${req.credits || 20} credits</span>
      </div>
      <button onclick="viewRequest('${req.id}')" style="padding:8px 16px;border:none;border-radius:8px;background:${hasApproached ? '#E9E9EB' : 'var(--primary)'};color:${hasApproached ? 'var(--text-muted)' : '#fff'};font-size:13px;font-weight:600;cursor:${hasApproached ? 'not-allowed' : 'pointer'};width:100%;" ${hasApproached ? 'disabled' : ''}>
        ${hasApproached ? '‚úì Already Approached' : 'View Details'}
      </button>
    </div>
  `}).join('');
}

function renderExpertApproaches() {
  if (!state.expertApproaches || state.expertApproaches.length === 0) {
    document.getElementById('expertTabApproaches').innerHTML = '<p style="text-align:center;color:var(--text-muted);padding:40px 20px;">Your approaches will appear here</p>';
    return;
  }
  
  document.getElementById('expertTabApproaches').innerHTML = `
    <div style="padding:20px;">
      ${state.expertApproaches.map(app => `
        <div style="background:#fff;border:1px solid var(--border);border-radius:12px;padding:16px;margin-bottom:12px;">
          <h4 style="font-size:16px;font-weight:700;margin-bottom:4px;">${app.requestTitle}</h4>
          <p style="font-size:13px;color:var(--text-muted);margin-bottom:8px;">${app.message}</p>
          <div style="display:flex;justify-content:space-between;align-items:center;">
            <span style="font-size:12px;color:var(--text-light);">Sent ${app.createdAt}</span>
            <span style="font-size:12px;padding:4px 12px;border-radius:12px;background:${app.status === 'pending' ? '#FFF4ED' : '#F0F0F0'};color:${app.status === 'pending' ? 'var(--primary)' : 'var(--text-muted)'};">${app.status.toUpperCase()}</span>
          </div>
        </div>
      `).join('')}
    </div>
  `;
}

function renderExpertProfile() {
  const profile = state.user.profile || {
    bio: '',
    specialization: '',
    experience: '',
    certifications: '',
    skills: []
  };
  
  const content = `
    <div class="section-title" style="margin-top:20px;">About</div>
    <div class="qual-item">
      <p style="color:var(--text);line-height:1.6;">${profile.bio || 'Add a bio to tell clients about yourself'}</p>
    </div>
    
    <div class="section-title" style="margin-top:16px;">Professional Details</div>
    <div class="qual-item">
      <h5>Specialization</h5>
      <p>${profile.specialization || 'Not specified'}</p>
    </div>
    <div class="qual-item">
      <h5>Company Name</h5>
      <p>${profile.companyName || 'Not specified'}</p>
    </div>
    <div class="qual-item">
      <h5>Experience</h5>
      <p>${profile.experience || 'Not specified'}</p>
    </div>
    <div class="qual-item">
      <h5>Company Size</h5>
      <p>${profile.companySize || 'Not specified'}</p>
    </div>
    <div class="qual-item">
      <h5>Certifications</h5>
      <p>${Array.isArray(profile.certifications) ? profile.certifications.join(', ') : profile.certifications || 'No certifications added'}</p>
    </div>
    
    <div class="section-title" style="margin-top:16px;">Contact</div>
    <div class="qual-item">
      <h5>Email</h5>
      <p>${state.user.email}</p>
    </div>
    <div class="qual-item">
      <h5>Phone</h5>
      <p>+91 ${state.user.phone}</p>
    </div>
  `;
  
  document.getElementById('expertProfileContent').innerHTML = content;
  document.getElementById('expertProfSpec').textContent = profile.specialization || 'Add your specialization';
  document.getElementById('expertProfName').textContent = state.user.name;
  document.getElementById('expertProfAvatar').textContent = state.user.name.charAt(0).toUpperCase();
  document.getElementById('expertAvatar').textContent = state.user.name.charAt(0).toUpperCase();
  
  // Update credits display
  document.getElementById('expertCredits').textContent = state.expertCredits;
}

// FIXED: View request with masked contact details
async function viewRequest(id) {
  const req = state.clientRequests.find(r => r.id === id);
  if (!req) return;
  
  // FIXED: Check if already approached
  if (state.approachedRequests.includes(id)) {
    alert('You have already approached this request!');
    return;
  }
  
  // Build questionnaire details
  let details = '';
  if (req.answers) {
    details = '<div style="margin-top:16px;"><div style="font-size:14px;font-weight:700;margin-bottom:12px;">Client Requirements:</div>';
    
    for (const [key, value] of Object.entries(req.answers)) {
      const formKey = Object.keys(Q_FORMS).find(k => Q_FORMS[k].key === key);
      if (formKey && Q_FORMS[formKey].title) {
        const displayValue = Array.isArray(value) ? value.join(', ') : value;
        details += `<div style="margin-bottom:8px;"><span style="font-size:12px;color:var(--text-muted);">${Q_FORMS[formKey].title}:</span><br><span style="font-size:14px;color:var(--text);">${displayValue}</span></div>`;
      }
    }
    details += '</div>';
  }
  
  const modalContent = `
    <div class="modal-title">${req.title}</div>
    <div class="modal-subtitle">Required Credits: ${req.credits || 20} üíé</div>
    
    <div style="margin-top:16px;">
      <div style="font-size:13px;color:var(--text-muted);margin-bottom:8px;">Description</div>
      <p style="font-size:14px;color:var(--text);line-height:1.6;">${req.desc}</p>
    </div>
    
    ${details}
    
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:16px;">
      <div>
        <div style="font-size:12px;color:var(--text-muted);">Location</div>
        <div style="font-size:14px;font-weight:600;">üìç ${req.location}</div>
      </div>
      <div>
        <div style="font-size:12px;color:var(--text-muted);">Budget</div>
        <div style="font-size:14px;font-weight:600;">üí∞ ${req.budget}</div>
      </div>
      <div>
        <div style="font-size:12px;color:var(--text-muted);">Timeline</div>
        <div style="font-size:14px;font-weight:600;">‚è∞ ${req.timeline}</div>
      </div>
      <div>
        <div style="font-size:12px;color:var(--text-muted);">Service</div>
        <div style="font-size:14px;font-weight:600;">üéØ ${req.service}</div>
      </div>
    </div>
    
    <div style="background:#FFF4ED;border:1px solid #FFDCC7;border-radius:8px;padding:12px;margin-top:16px;">
      <div style="font-size:12px;color:var(--text-muted);margin-bottom:4px;">‚ÑπÔ∏è Contact Details</div>
      <div style="font-size:13px;color:var(--text);">Email and phone will be revealed after you send your approach and the client accepts.</div>
    </div>
    
    <div class="field" style="margin-top:16px;">
      <label>Your Message to Client</label>
      <textarea id="approachMessage" rows="4" placeholder="Introduce yourself and explain how you can help..."></textarea>
    </div>
    
    <button class="submit-btn" onclick="sendApproach('${id}', ${req.credits || 20})">
      Send Approach (${req.credits || 20} Credits)
    </button>
    <button class="btn-outline" style="width:100%;margin-top:10px;" onclick="closeModal()">Cancel</button>
  `;
  
  document.getElementById('modalContent').innerHTML = modalContent;
  document.getElementById('modal').classList.add('open');
}

// FIXED: Send approach and track it
async function sendApproach(requestId, creditsNeeded) {
  const message = document.getElementById('approachMessage').value.trim();
  
  if (!message) {
    alert('Please write a message to the client');
    return;
  }
  
  if (state.expertCredits < creditsNeeded) {
    alert(`Insufficient credits! You need ${creditsNeeded} credits but have only ${state.expertCredits}`);
    return;
  }
  
  try {
    const res = await fetch(`${API_URL}/approaches`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${state.token}`
      },
      body: JSON.stringify({
        requestId,
        message
      })
    });
    
    const data = await res.json();
    if (!res.ok) throw new Error(data.message || 'Failed to send approach');
    
    // ‚≠ê FIXED: Handle credits properly
    state.expertCredits = data.creditsRemaining || (state.expertCredits - creditsNeeded);
    state.user.credits = state.expertCredits;
    localStorage.setItem('user', JSON.stringify(state.user));
    
    // Add to approached list
    state.approachedRequests.push(requestId);
    
    // ‚≠ê FIXED: Add to unlocked list to show contact details
    state.unlockedRequests.push(requestId);
    
    // Add to approaches with contact info
    const request = state.clientRequests.find(r => r.id === requestId);
    state.expertApproaches.push({
      id: data.approachId || Date.now().toString(),
      requestId: requestId,
      requestTitle: request?.title || 'Request',
      message: message,
      status: 'pending',
      createdAt: new Date().toLocaleDateString(),
      // ‚≠ê NEW: Store contact details from backend response
      clientEmail: data.clientEmail || 'Email available after acceptance',
      clientPhone: data.clientPhone || 'Phone available after acceptance'
    });
    
    closeModal();
    alert('‚úÖ Approach sent successfully! Contact details will be visible in your Approaches tab.');
    
    // Reload and refresh display
    await loadExpertApproaches();
    renderExpertBrowse();
    renderExpertProfile();
    
  } catch (error) {
    alert(error.message);
  }
}

function closeModal() {
  document.getElementById('modal').classList.remove('open');
}

function openEditProfile() {
  alert('Edit profile feature coming soon!');
}

function openBuyCredits() {
  alert('Buy credits feature coming soon!');
}

function logout() {
  if (confirm('Are you sure you want to logout?')) {
    localStorage.clear();
    state = {
      role: null,
      user: null,
      userId: null,
      token: null,
      authMode: 'login',
      verifyStep: 0,
      qStep: 0,
      qAnswers: {},
      qSequence: null,
      clientRequests: [],
      expertApproaches: [],
      expertCredits: 50,
      unlockedRequests: [],
      approachedRequests: []
    };
    goPage('landing');
  }
}

// FIXED: Auto-login and load all data
window.addEventListener('load', async () => {
  const token = localStorage.getItem('token');
  const user = localStorage.getItem('user');
  
  if (token && user) {
    state.token = token;
    state.user = JSON.parse(user);
    state.role = state.user.role;
    state.expertCredits = state.user.credits || 50;
    
    // Load data before entering dashboard
    if (state.role === 'client') {
      await loadClientRequests();
    } else {
      await loadExpertRequests();
      await loadExpertApproaches();
    }
    
    enterDashboard();
  }
});

</script>
</body>
</html>
